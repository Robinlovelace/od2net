import{S as ae,i as re,s as ie,ab as I,e as g,f as B,z as E,l as k,E as V,v as y,ac as X,g as A,n as w,a6 as $e,L as ge,c as M,a as N,t as v,b as S,d as q,o as be,H as he,h as U,q as fe,r as ue,u as pe,M as we,x as Z,y as ce,A as _e,_ as ke,$ as ye,a3 as L,ad as Y,C as ve,j as D,k as Ce,p as x,ae as W,a9 as me,aa as j,a2 as Se,a0 as P,a4 as Fe,a5 as Le}from"./Legend-52595ab8.js";import{_ as je,J as Me,C as Ne,G as qe}from"./CostFunction-a8c702f0.js";function ee(o,e,n){const t=o.slice();return t[2]=e[n],t}function te(o,e,n){const t=o.slice();return t[5]=e[n],t}function ne(o){let e,n;return{c(){e=g("span"),n=A(`Â 
    `),E(e,"background",o[5]),E(e,"width","100%"),E(e,"border","1px solid black")},m(t,s){k(t,e,s),w(e,n)},p(t,s){s&1&&E(e,"background",t[5])},d(t){t&&y(e)}}}function le(o){let e,n=o[2].toFixed(1)+"",t;return{c(){e=g("span"),t=A(n)},m(s,l){k(s,e,l),w(e,t)},p(s,l){l&2&&n!==(n=s[2].toFixed(1)+"")&&$e(t,n)},d(s){s&&y(e)}}}function Oe(o){let e,n,t,s=I(o[0]),l=[];for(let a=0;a<s.length;a+=1)l[a]=ne(te(o,s,a));let f=I(o[1]),i=[];for(let a=0;a<f.length;a+=1)i[a]=le(ee(o,f,a));return{c(){e=g("div");for(let a=0;a<l.length;a+=1)l[a].c();n=B(),t=g("div");for(let a=0;a<i.length;a+=1)i[a].c();E(e,"display","flex"),E(t,"display","flex"),E(t,"justify-content","space-between")},m(a,p){k(a,e,p);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null);k(a,n,p),k(a,t,p);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(t,null)},p(a,[p]){if(p&1){s=I(a[0]);let r;for(r=0;r<s.length;r+=1){const c=te(a,s,r);l[r]?l[r].p(c,p):(l[r]=ne(c),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=s.length}if(p&2){f=I(a[1]);let r;for(r=0;r<f.length;r+=1){const c=ee(a,f,r);i[r]?i[r].p(c,p):(i[r]=le(c),i[r].c(),i[r].m(t,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=f.length}},i:V,o:V,d(a){a&&(y(e),y(n),y(t)),X(l,a),X(i,a)}}}function Be(o,e,n){let{colorScale:t}=e,{limits:s}=e;return o.$$set=l=>{"colorScale"in l&&n(0,t=l.colorScale),"limits"in l&&n(1,s=l.limits)},[t,s]}class Ee extends ae{constructor(e){super(),re(this,e,Be,Oe,ie,{colorScale:0,limits:1})}}function se(o){let e,n,t,s,l,f,i,a,p,r,c,b,F,J,_,d,O,T,H,G;const m=[Te,Je],h=[];function $(u,C){return u[4]=="lts"?0:1}c=$(o),b=h[c]=m[c](o);function de(u){o[15](u)}let K={};return o[0]!==void 0&&(K.cost=o[0]),d=new Ne({props:K}),Z.push(()=>ce(d,"cost",de)),{c(){e=g("hr"),n=B(),t=g("div"),s=g("label"),l=A(`Color edges by:
          `),f=g("select"),i=g("option"),i.textContent="LTS",a=g("option"),a.textContent="Edge cost (relative to length)",p=g("option"),p.textContent="Nearby amenities",r=B(),b.c(),F=B(),J=g("hr"),_=B(),M(d.$$.fragment),i.__value="lts",D(i,i.__value),a.__value="cost",D(a,a.__value),p.__value="nearby_amenities",D(p,p.__value),o[4]===void 0&&Ce(()=>o[14].call(f))},m(u,C){k(u,e,C),k(u,n,C),k(u,t,C),w(t,s),w(s,l),w(s,f),w(f,i),w(f,a),w(f,p),x(f,o[4],!0),k(u,r,C),h[c].m(u,C),k(u,F,C),k(u,J,C),k(u,_,C),N(d,u,C),T=!0,H||(G=fe(f,"change",o[14]),H=!0)},p(u,C){C&16&&x(f,u[4]);let z=c;c=$(u),c===z?h[c].p(u,C):(ue(),S(h[z],1,1,()=>{h[z]=null}),pe(),b=h[c],b?b.p(u,C):(b=h[c]=m[c](u),b.c()),v(b,1),b.m(F.parentNode,F));const Q={};!O&&C&1&&(O=!0,Q.cost=u[0],_e(()=>O=!1)),d.$set(Q)},i(u){T||(v(b),v(d.$$.fragment,u),T=!0)},o(u){S(b),S(d.$$.fragment,u),T=!1},d(u){u&&(y(e),y(n),y(t),y(r),y(F),y(J),y(_)),h[c].d(u),q(d,u),H=!1,G()}}}function Je(o){let e,n,t,s;return e=new Ee({props:{colorScale:W,limits:R(o[4],o[6],o[7])}}),t=new me({props:{rows:[[j.lts_not_allowed,L.lts_not_allowed]]}}),{c(){M(e.$$.fragment),n=B(),M(t.$$.fragment)},m(l,f){N(e,l,f),k(l,n,f),N(t,l,f),s=!0},p(l,f){const i={};f&208&&(i.limits=R(l[4],l[6],l[7])),e.$set(i)},i(l){s||(v(e.$$.fragment,l),v(t.$$.fragment,l),s=!0)},o(l){S(e.$$.fragment,l),S(t.$$.fragment,l),s=!1},d(l){l&&y(n),q(e,l),q(t,l)}}}function Te(o){let e,n,t,s;return e=new me({props:{rows:[[`${j.lts1}: ${o[5][1].toFixed(0)}% of roads by distance`,L.lts1],[`${j.lts2}: ${o[5][2].toFixed(0)}%`,L.lts2],[`${j.lts3}: ${o[5][3].toFixed(0)}%`,L.lts3],[`${j.lts4}: ${o[5][4].toFixed(0)}%`,L.lts4],[j.lts_not_allowed,L.lts_not_allowed]]}}),{c(){M(e.$$.fragment),n=B(),t=g("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(l,f){N(e,l,f),k(l,n,f),k(l,t,f),s=!0},p(l,f){const i={};f&32&&(i.rows=[[`${j.lts1}: ${l[5][1].toFixed(0)}% of roads by distance`,L.lts1],[`${j.lts2}: ${l[5][2].toFixed(0)}%`,L.lts2],[`${j.lts3}: ${l[5][3].toFixed(0)}%`,L.lts3],[`${j.lts4}: ${l[5][4].toFixed(0)}%`,L.lts4],[j.lts_not_allowed,L.lts_not_allowed]]),e.$set(i)},i(l){s||(v(e.$$.fragment,l),s=!0)},o(l){S(e.$$.fragment,l),s=!1},d(l){l&&(y(n),y(t)),q(e,l)}}}function He(o){let e,n,t,s,l,f,i,a,p,r,c,b,F,J;n=new he({props:{app:"costs"}});let _=o[2]&&se(o);return{c(){e=g("div"),M(n.$$.fragment),t=B(),s=g("label"),l=A("Open a "),f=g("i"),f.textContent=".bin",i=A(" network file or an "),a=g("i"),a.textContent=".osm.pbf",p=B(),r=g("input"),c=B(),_&&_.c(),U(r,"type","file"),U(e,"slot","left")},m(d,O){k(d,e,O),N(n,e,null),w(e,t),w(e,s),w(s,l),w(s,f),w(s,i),w(s,a),w(s,p),w(s,r),o[13](r),w(e,c),_&&_.m(e,null),b=!0,F||(J=fe(r,"change",o[9]),F=!0)},p(d,O){d[2]?_?(_.p(d,O),O&4&&v(_,1)):(_=se(d),_.c(),v(_,1),_.m(e,null)):_&&(ue(),S(_,1,1,()=>{_=null}),pe())},i(d){b||(v(n.$$.fragment,d),v(_),b=!0)},o(d){S(n.$$.fragment,d),S(_),b=!1},d(d){d&&y(e),q(n),o[13](null),_&&_.d(),F=!1,J()}}}function Ae(o){let e,n;return e=new Le({props:{properties:o[18][0].properties}}),{c(){M(e.$$.fragment)},m(t,s){N(e,t,s),n=!0},p(t,s){const l={};s&262144&&(l.properties=t[18][0].properties),e.$set(l)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Ge(o){let e,n;return e=new Fe({props:{openOn:"hover",$$slots:{default:[Ae,({features:t})=>({18:t}),({features:t})=>t?262144:0]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(t,s){N(e,t,s),n=!0},p(t,s){const l={};s&786432&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Ie(o){let e,n;return e=new Se({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":o[10](o[4],o[6],o[7]),"line-opacity":o[4]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,P(1,.5)]:P(1,.5)},beforeId:"Road labels",$$slots:{default:[Ge]},$$scope:{ctx:o}}}),e.$on("click",o[11]),{c(){M(e.$$.fragment)},m(t,s){N(e,t,s),n=!0},p(t,s){const l={};s&208&&(l.paint={"line-width":5,"line-color":t[10](t[4],t[6],t[7]),"line-opacity":t[4]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,P(1,.5)]:P(1,.5)}),s&524288&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Pe(o){let e,n;return e=new qe({props:{data:o[3],$$slots:{default:[Ie]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(t,s){N(e,t,s),n=!0},p(t,s){const l={};s&8&&(l.data=t[3]),s&524496&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Re(o){let e,n,t,s;function l(i){o[12](i)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Pe]},$$scope:{ctx:o}};return o[1]!==void 0&&(f.map=o[1]),n=new we({props:f}),Z.push(()=>ce(n,"map",l)),{c(){e=g("div"),M(n.$$.fragment),U(e,"slot","main"),E(e,"position","relative"),E(e,"width","100%"),E(e,"height","100vh")},m(i,a){k(i,e,a),N(n,e,null),s=!0},p(i,a){const p={};a&524504&&(p.$$scope={dirty:a,ctx:i}),!t&&a&2&&(t=!0,p.map=i[1],_e(()=>t=!1)),n.$set(p)},i(i){s||(v(n.$$.fragment,i),s=!0)},o(i){S(n.$$.fragment,i),s=!1},d(i){i&&y(e),q(n)}}}function ze(o){let e,n;return e=new ge({props:{$$slots:{main:[Re],left:[He]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(t,s){N(e,t,s),n=!0},p(t,[s]){const l={};s&524799&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function De(o){let e=o.properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function R(o,e,n){if(o=="lts")return null;if(o=="cost")return oe(0,e);if(o=="nearby_amenities")return oe(0,n)}function oe(o,e){let n=[],t=(e-o)/5;for(let s=0;s<6;s++)n.push(o+s*t);return n}function Ue(o,e,n){be(async()=>{await je(),await ke()});let t,s,l={type:"FeatureCollection",features:[]},f="Distance",i="cost",a=[0,0,0,0,0],p=1,r=1,c;async function b(m){try{let h=await c.files[0].arrayBuffer();n(2,s=new Me(new Uint8Array(h)));let $=s.getBounds();t.fitBounds([[$[0],$[1]],[$[2],$[3]]],{padding:20,animate:!1}),F()}catch(h){window.alert(`Problem loading network file: ${h}`)}}function F(){n(3,l=JSON.parse(s.debugNetwork()));let m=0,h=[0,0,0,0,0];n(6,p=0),n(7,r=0);for(let $ of l.features)n(7,r=Math.max(r,$.properties.nearby_amenities)),$.properties.length&&(n(6,p=Math.max(p,$.properties.cost/$.properties.length)),m+=$.properties.length,h[$.properties.lts]+=$.properties.length);n(5,a=h.map($=>$/m*100))}function J(m,h,$){if(m=="lts")return ye;if(m=="cost")return["case",["==",0,["get","lts"]],L.lts_not_allowed,Y(["/",["get","cost"],["get","length"]],R(m,h,$),W)];if(m=="nearby_amenities")return Y(["get","nearby_amenities"],R(m,h,$),W)}function _(m){s&&(s.updateCostFunction(m),F())}const d=m=>De(m.detail.features[0]);function O(m){t=m,n(1,t)}function T(m){Z[m?"unshift":"push"](()=>{c=m,n(8,c)})}function H(){i=ve(this),n(4,i)}function G(m){f=m,n(0,f)}return o.$$.update=()=>{o.$$.dirty&1&&_(f)},[f,t,s,l,i,a,p,r,c,b,J,d,O,T,H,G]}class We extends ae{constructor(e){super(),re(this,e,Ue,ze,ie,{})}}new We({target:document.getElementById("app")});
