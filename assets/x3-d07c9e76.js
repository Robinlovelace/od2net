import{S as ge,i as $e,s as be,ab as K,e as $,f as N,z as T,l as k,E as oe,v as y,ac as ae,g as W,n as b,W as he,L as ye,c as j,a as B,t as C,b as F,d as q,o as ve,H as Se,x as Y,y as le,h as Q,q as te,A as se,r as we,u as ke,M as Ce,_ as Fe,a0 as Le,a4 as G,ad as re,C as Me,j as ee,k as Oe,p as ie,w as Ne,ae as ne,a1 as je,a9 as Be,aa as I,a3 as qe,a5 as Ee,a6 as Je}from"./Legend-fb6fd039.js";import{L as Te,C as Ae,O as Ge,_ as He,J as Pe,a as De,G as Ie}from"./OverpassSelector-59562d92.js";function fe(l,e,n){const t=l.slice();return t[2]=e[n],t}function pe(l,e,n){const t=l.slice();return t[5]=e[n],t}function ue(l){let e,n;return{c(){e=$("span"),n=W(`Â 
    `),T(e,"background",l[5]),T(e,"width","100%"),T(e,"border","1px solid black")},m(t,s){k(t,e,s),b(e,n)},p(t,s){s&1&&T(e,"background",t[5])},d(t){t&&y(e)}}}function ce(l){let e,n=l[2].toFixed(1)+"",t;return{c(){e=$("span"),t=W(n)},m(s,o){k(s,e,o),b(e,t)},p(s,o){o&2&&n!==(n=s[2].toFixed(1)+"")&&he(t,n)},d(s){s&&y(e)}}}function Re(l){let e,n,t,s=K(l[0]),o=[];for(let a=0;a<s.length;a+=1)o[a]=ue(pe(l,s,a));let f=K(l[1]),i=[];for(let a=0;a<f.length;a+=1)i[a]=ce(fe(l,f,a));return{c(){e=$("div");for(let a=0;a<o.length;a+=1)o[a].c();n=N(),t=$("div");for(let a=0;a<i.length;a+=1)i[a].c();T(e,"display","flex"),T(t,"display","flex"),T(t,"justify-content","space-between")},m(a,m){k(a,e,m);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null);k(a,n,m),k(a,t,m);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(t,null)},p(a,[m]){if(m&1){s=K(a[0]);let r;for(r=0;r<s.length;r+=1){const d=pe(a,s,r);o[r]?o[r].p(d,m):(o[r]=ue(d),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=s.length}if(m&2){f=K(a[1]);let r;for(r=0;r<f.length;r+=1){const d=fe(a,f,r);i[r]?i[r].p(d,m):(i[r]=ce(d),i[r].c(),i[r].m(t,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=f.length}},i:oe,o:oe,d(a){a&&(y(e),y(n),y(t)),ae(o,a),ae(i,a)}}}function Xe(l,e,n){let{colorScale:t}=e,{limits:s}=e;return l.$$set=o=>{"colorScale"in o&&n(0,t=o.colorScale),"limits"in o&&n(1,s=o.limits)},[t,s]}class ze extends ge{constructor(e){super(),$e(this,e,Xe,Re,be,{colorScale:0,limits:1})}}function _e(l){let e,n;return{c(){e=$("p"),n=W(l[12])},m(t,s){k(t,e,s),b(e,n)},p(t,s){s[0]&4096&&he(n,t[12])},d(t){t&&y(e)}}}function me(l){let e,n,t,s,o,f,i,a,m,r,d,v,h,E,J,M,P,H,R,D,_,g,c,O,X;const z=[Ue,We],A=[];function U(u,w){return u[5]=="lts"?0:1}d=U(l),v=A[d]=z[d](l);function x(u){l[25](u)}let Z={};return l[1]!==void 0&&(Z.cost=l[1]),_=new De({props:Z}),Y.push(()=>le(_,"cost",x)),{c(){e=$("hr"),n=N(),t=$("div"),s=$("label"),o=W(`Color edges by:
          `),f=$("select"),i=$("option"),i.textContent="LTS",a=$("option"),a.textContent="Edge cost (relative to length)",m=$("option"),m.textContent="Nearby amenities",r=N(),v.c(),h=N(),E=$("div"),J=$("label"),M=$("input"),P=W(`
          Show cyclists not allowed`),H=N(),R=$("hr"),D=N(),j(_.$$.fragment),i.__value="lts",ee(i,i.__value),a.__value="cost",ee(a,a.__value),m.__value="nearby_amenities",ee(m,m.__value),l[5]===void 0&&Oe(()=>l[23].call(f)),Q(M,"type","checkbox"),T(J,"color",G.lts_not_allowed)},m(u,w){k(u,e,w),k(u,n,w),k(u,t,w),b(t,s),b(s,o),b(s,f),b(f,i),b(f,a),b(f,m),ie(f,l[5],!0),k(u,r,w),A[d].m(u,w),k(u,h,w),k(u,E,w),b(E,J),b(J,M),M.checked=l[6],b(J,P),k(u,H,w),k(u,R,w),k(u,D,w),B(_,u,w),c=!0,O||(X=[te(f,"change",l[23]),te(M,"change",l[24])],O=!0)},p(u,w){w[0]&32&&ie(f,u[5]);let p=d;d=U(u),d===p?A[d].p(u,w):(we(),F(A[p],1,1,()=>{A[p]=null}),ke(),v=A[d],v?v.p(u,w):(v=A[d]=z[d](u),v.c()),C(v,1),v.m(h.parentNode,h)),w[0]&64&&(M.checked=u[6]);const S={};!g&&w[0]&2&&(g=!0,S.cost=u[1],se(()=>g=!1)),_.$set(S)},i(u){c||(C(v),C(_.$$.fragment,u),c=!0)},o(u){F(v),F(_.$$.fragment,u),c=!1},d(u){u&&(y(e),y(n),y(t),y(r),y(h),y(E),y(H),y(R),y(D)),A[d].d(u),q(_,u),O=!1,Ne(X)}}}function We(l){let e,n;return e=new ze({props:{colorScale:ne,limits:V(l[5],l[9],l[10])}}),{c(){j(e.$$.fragment)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s[0]&1568&&(o.limits=V(t[5],t[9],t[10])),e.$set(o)},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Ue(l){let e,n,t,s;return e=new Be({props:{rows:[[`${I.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,G.lts1],[`${I.lts2}: ${l[8][2].toFixed(0)}%`,G.lts2],[`${I.lts3}: ${l[8][3].toFixed(0)}%`,G.lts3],[`${I.lts4}: ${l[8][4].toFixed(0)}%`,G.lts4]]}}),{c(){j(e.$$.fragment),n=N(),t=$("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(o,f){B(e,o,f),k(o,n,f),k(o,t,f),s=!0},p(o,f){const i={};f[0]&256&&(i.rows=[[`${I.lts1}: ${o[8][1].toFixed(0)}% of roads by distance`,G.lts1],[`${I.lts2}: ${o[8][2].toFixed(0)}%`,G.lts2],[`${I.lts3}: ${o[8][3].toFixed(0)}%`,G.lts3],[`${I.lts4}: ${o[8][4].toFixed(0)}%`,G.lts4]]),e.$set(i)},i(o){s||(C(e.$$.fragment,o),s=!0)},o(o){F(e.$$.fragment,o),s=!1},d(o){o&&(y(n),y(t)),q(e,o)}}}function Ze(l){let e,n,t,s,o,f,i,a,m,r,d,v,h,E,J,M,P,H;n=new Se({props:{app:"costs"}});function R(c){l[20](c)}let D={};l[0]!==void 0&&(D.example=l[0]),r=new Ae({props:D}),Y.push(()=>le(r,"example",R)),h=new Ge({props:{map:l[2]}}),h.$on("gotXml",l[16]),h.$on("loading",l[21]),h.$on("error",l[22]);let _=l[12]&&_e(l),g=l[3]&&me(l);return{c(){e=$("div"),j(n.$$.fragment),t=N(),s=$("label"),o=W("Open an "),f=$("i"),f.textContent=".osm.pbf",i=W(` file
      `),a=$("input"),m=N(),j(r.$$.fragment),v=N(),j(h.$$.fragment),E=N(),_&&_.c(),J=N(),g&&g.c(),Q(a,"type","file"),Q(e,"slot","left")},m(c,O){k(c,e,O),B(n,e,null),b(e,t),b(e,s),b(s,o),b(s,f),b(s,i),b(s,a),l[19](a),b(e,m),B(r,e,null),b(e,v),B(h,e,null),b(e,E),_&&_.m(e,null),b(e,J),g&&g.m(e,null),M=!0,P||(H=te(a,"change",l[13]),P=!0)},p(c,O){const X={};!d&&O[0]&1&&(d=!0,X.example=c[0],se(()=>d=!1)),r.$set(X);const z={};O[0]&4&&(z.map=c[2]),h.$set(z),c[12]?_?_.p(c,O):(_=_e(c),_.c(),_.m(e,J)):_&&(_.d(1),_=null),c[3]?g?(g.p(c,O),O[0]&8&&C(g,1)):(g=me(c),g.c(),C(g,1),g.m(e,null)):g&&(we(),F(g,1,1,()=>{g=null}),ke())},i(c){M||(C(n.$$.fragment,c),C(r.$$.fragment,c),C(h.$$.fragment,c),C(g),M=!0)},o(c){F(n.$$.fragment,c),F(r.$$.fragment,c),F(h.$$.fragment,c),F(g),M=!1},d(c){c&&y(e),q(n),l[19](null),q(r),q(h),_&&_.d(),g&&g.d(),P=!1,H()}}}function Ke(l){let e,n;return e=new Je({props:{properties:l[30][0].properties}}),{c(){j(e.$$.fragment)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s[0]&1073741824&&(o.properties=t[30][0].properties),e.$set(o)},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Qe(l){let e,n;return e=new Ee({props:{openOn:"hover",$$slots:{default:[Ke,({features:t})=>({30:t}),({features:t})=>[t?1073741824:0]]},$$scope:{ctx:l}}}),{c(){j(e.$$.fragment)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s[0]&1073741824|s[1]&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Ve(l){let e,n;return e=new qe({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":l[14](l[5],l[9],l[10]),"line-opacity":l[15](l[5],l[6])},beforeId:"Road labels",$$slots:{default:[Qe]},$$scope:{ctx:l}}}),e.$on("click",l[17]),{c(){j(e.$$.fragment)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s[0]&1632&&(o.paint={"line-width":5,"line-color":t[14](t[5],t[9],t[10]),"line-opacity":t[15](t[5],t[6])}),s[1]&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function Ye(l){let e,n;return e=new Ie({props:{data:l[4],$$slots:{default:[Ve]},$$scope:{ctx:l}}}),{c(){j(e.$$.fragment)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s[0]&16&&(o.data=t[4]),s[0]&1632|s[1]&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){q(e,t)}}}function xe(l){let e,n,t,s;function o(i){l[18](i)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ye]},$$scope:{ctx:l}};return l[2]!==void 0&&(f.map=l[2]),n=new Ce({props:f}),Y.push(()=>le(n,"map",o)),{c(){e=$("div"),j(n.$$.fragment),Q(e,"slot","main"),T(e,"position","relative"),T(e,"width","100%"),T(e,"height","100vh")},m(i,a){k(i,e,a),B(n,e,null),s=!0},p(i,a){const m={};a[0]&1648|a[1]&1&&(m.$$scope={dirty:a,ctx:i}),!t&&a[0]&4&&(t=!0,m.map=i[2],se(()=>t=!1)),n.$set(m)},i(i){s||(C(n.$$.fragment,i),s=!0)},o(i){F(n.$$.fragment,i),s=!1},d(i){i&&y(e),q(n)}}}function et(l){let e,n,t,s;return e=new ye({props:{$$slots:{main:[xe],left:[Ze]},$$scope:{ctx:l}}}),t=new Te({props:{loading:l[7]}}),{c(){j(e.$$.fragment),n=N(),j(t.$$.fragment)},m(o,f){B(e,o,f),k(o,n,f),B(t,o,f),s=!0},p(o,f){const i={};f[0]&8063|f[1]&1&&(i.$$scope={dirty:f,ctx:o}),e.$set(i);const a={};f[0]&128&&(a.loading=o[7]),t.$set(a)},i(o){s||(C(e.$$.fragment,o),C(t.$$.fragment,o),s=!0)},o(o){F(e.$$.fragment,o),F(t.$$.fragment,o),s=!1},d(o){o&&y(n),q(e,o),q(t,o)}}}function tt(l){let e=l.properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function V(l,e,n){if(l=="lts")return null;if(l=="cost")return de(0,e);if(l=="nearby_amenities")return de(0,n)}function de(l,e){let n=[],t=(e-l)/5;for(let s=0;s<6;s++)n.push(l+s*t);return n}function nt(l,e,n){ve(async()=>{await He(),await Fe()});let t,s,o="",f={type:"FeatureCollection",features:[]},i="Distance",a="cost",m=!1,r=!1,d=[0,0,0,0,0],v=1,h=1,E;async function J(p){n(0,o=""),n(7,r=!0),M(await E.files[0].arrayBuffer())}function M(p){try{n(3,s=new Pe(new Uint8Array(p))),n(1,i="Distance");let S=s.getBounds();t.fitBounds([[S[0],S[1]],[S[2],S[3]]],{padding:20,animate:!1}),H()}catch(S){window.alert(`Problem importing osm.pbf file: ${S}`)}n(7,r=!1)}async function P(p){if(p!=""){n(7,r=!0);let S=await fetch(`https://assets.od2net.org/pbf_clips/${p}.osm.pbf`);M(await S.arrayBuffer())}}function H(){n(4,f=JSON.parse(s.debugNetwork()));let p=0,S=[0,0,0,0,0];n(9,v=0),n(10,h=0);for(let L of f.features)n(10,h=Math.max(h,L.properties.nearby_amenities)),L.properties.length&&(n(9,v=Math.max(v,L.properties.cost/L.properties.length)),p+=L.properties.length,S[L.properties.lts]+=L.properties.length);n(8,d=S.map(L=>L/p*100))}function R(p,S,L){if(p=="lts")return Le;if(p=="cost")return["case",["==",0,["get","lts"]],G.lts_not_allowed,re(["/",["get","cost"],["get","length"]],V(p,S,L),ne)];if(p=="nearby_amenities")return re(["get","nearby_amenities"],V(p,S,L),ne)}function D(p,S){let L=je(1,.5);return p=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,L]:S?L:["case",["==",0,["get","lts"]],0,L]}let _="";function g(p){n(12,_="Got XML, see console"),console.log(p.detail)}function c(p){s&&(s.updateCostFunction(p),H())}const O=p=>tt(p.detail.features[0]);function X(p){t=p,n(2,t)}function z(p){Y[p?"unshift":"push"](()=>{E=p,n(11,E)})}function A(p){o=p,n(0,o)}const U=p=>n(12,_=p.detail),x=p=>n(12,_=p.detail);function Z(){a=Me(this),n(5,a)}function u(){m=this.checked,n(6,m)}function w(p){i=p,n(1,i)}return l.$$.update=()=>{l.$$.dirty[0]&1&&P(o),l.$$.dirty[0]&2&&c(i)},[o,i,t,s,f,a,m,r,d,v,h,E,_,J,R,D,g,O,X,z,A,U,x,Z,u,w]}class lt extends ge{constructor(e){super(),$e(this,e,nt,et,be,{},null,[-1,-1])}}new lt({target:document.getElementById("app")});
