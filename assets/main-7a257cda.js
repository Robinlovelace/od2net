import{S as ne,i as le,s as F,m as ie,P as re,L as se,c as E,a as O,t as _,b,d as D,o as ue,H as pe,e as g,f as I,g as q,h as z,j as M,k as fe,l as C,n as m,p as j,q as K,r as N,u as P,v as S,w as me,M as ce,x as R,y as G,z as Y,A as J,_ as de,B as X,F as _e,C as ge,D as ae,E as be}from"./SequentialLegend-04a99162.js";import{S as he,L as ve}from"./SidebarControls-812e1477.js";const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAm0lEQVRIS+2U0Q2AIAxEYQM30Q3UDXQy3UhHkE0cweuHHxKTXpuQaALJ/cE9eoXGUHjFwv6hAtSEPxFRh2su0Ayd6pWzDUwFO8700AGNVggDaGAqkNYDYQBStBvCAtwQC8AF8QA2kORlJWjQmm4BSB9M5lIyC3CZswC3OQu4PxqVef7TmYikoSs0aQ19GyMMwDp+HvsrQI3v/xFduXoiGbi1DtQAAAAASUVORK5CYII=";let Z="pmtilesSource";async function we(l){let e=await l.getHeader(),o=await l.getMetadata();return{bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],outputMetadata:JSON.parse(o.description),minZoom:e.minZoom,maxZoom:e.maxZoom}}function ke(l,e,o){let{pmtiles:t}=e,{map:n}=e,{outputMetadata:a=null}=e,i=new re;ie.addProtocol("pmtiles",i.tile);async function p(s){r(Z),i.add(s);let f=await we(s);n.addSource(Z,{type:"vector",tiles:["pmtiles://"+s.source.getKey()+"/{z}/{x}/{y}"],minzoom:f.minZoom,maxzoom:f.maxZoom,bounds:f.bounds}),n.fitBounds(f.bounds,{padding:100,duration:500}),o(0,a=f.outputMetadata)}function r(s){if(n.getSource(s)){let f=[];for(let u of n.getStyle().layers)"source"in u&&u.source==s&&f.push(u.id);for(let u of f)n.removeLayer(u);n.removeSource(s)}}return l.$$set=s=>{"pmtiles"in s&&o(1,t=s.pmtiles),"map"in s&&o(2,n=s.map),"outputMetadata"in s&&o(0,a=s.outputMetadata)},l.$$.update=()=>{l.$$.dirty&2&&(t?p(t):r(Z))},[a,t,n]}class ye extends ne{constructor(e){super(),le(this,e,ke,null,F,{pmtiles:1,map:2,outputMetadata:0})}}function W(l){let e,o,t;return{c(){e=q("Open a "),o=g("i"),o.textContent=".pmtiles",t=q(`
        file produced by the tool. Note this file stays in your browser; it doesn't
        get uploaded anywhere.`)},m(n,a){C(n,e,a),C(n,o,a),C(n,t,a)},d(n){n&&(S(e),S(o),S(t))}}}function x(l){let e,o,t;function n(i){l[12](i)}let a={outputMetadata:l[3],map:l[1]};return l[4]!==void 0&&(a.controls=l[4]),e=new he({props:a}),R.push(()=>G(e,"controls",n)),{c(){E(e.$$.fragment)},m(i,p){O(e,i,p),t=!0},p(i,p){const r={};p&8&&(r.outputMetadata=i[3]),p&2&&(r.map=i[1]),!o&&p&16&&(o=!0,r.controls=i[4],J(()=>o=!1)),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function $e(l){let e,o,t,n,a,i,p,r,s,f,u,w,k,y,$,c,A,L,Q,T,H,U,V;o=new pe({props:{app:"main"}});let h=l[2]==null&&W(),d=l[3]&&x(l);return{c(){e=g("div"),E(o.$$.fragment),t=I(),n=g("label"),h&&h.c(),a=I(),i=g("input"),p=I(),r=g("div"),s=g("label"),f=q(`Or load an example:
        `),u=g("select"),w=g("option"),w.textContent="Custom file loaded",k=g("option"),k.textContent="Edinburgh",y=g("option"),y.textContent=`England (2011 home-to-work)
          `,$=g("option"),$.textContent="Liverpool (direct)",c=g("option"),c.textContent="Liverpool (quiet)",A=g("option"),A.textContent="London",L=g("option"),L.textContent="Seattle",Q=g("option"),Q.textContent="York",T=I(),d&&d.c(),z(i,"type","file"),w.__value="",M(w,w.__value),k.__value="edinburgh",M(k,k.__value),y.__value="england_2011_home_to_work",M(y,y.__value),$.__value="liverpool_direct",M($,$.__value),c.__value="liverpool_quiet",M(c,c.__value),A.__value="london",M(A,A.__value),L.__value="seattle",M(L,L.__value),Q.__value="york",M(Q,Q.__value),l[0]===void 0&&fe(()=>l[11].call(u)),z(e,"slot","left")},m(v,B){C(v,e,B),O(o,e,null),m(e,t),m(e,n),h&&h.m(n,null),m(n,a),m(n,i),l[10](i),m(e,p),m(e,r),m(r,s),m(s,f),m(s,u),m(u,w),m(u,k),m(u,y),m(u,$),m(u,c),m(u,A),m(u,L),m(u,Q),j(u,l[0],!0),m(e,T),d&&d.m(e,null),H=!0,U||(V=[K(i,"change",l[6]),K(u,"change",l[11])],U=!0)},p(v,B){v[2]==null?h||(h=W(),h.c(),h.m(n,a)):h&&(h.d(1),h=null),B&1&&j(u,v[0]),v[3]?d?(d.p(v,B),B&8&&_(d,1)):(d=x(v),d.c(),_(d,1),d.m(e,null)):d&&(N(),b(d,1,1,()=>{d=null}),P())},i(v){H||(_(o.$$.fragment,v),_(d),H=!0)},o(v){b(o.$$.fragment,v),b(d),H=!1},d(v){v&&S(e),D(o),h&&h.d(),l[10](null),d&&d.d(),U=!1,me(V)}}}function ee(l){let e=l[3],o,t,n=te(l);return{c(){n.c(),o=ae()},m(a,i){n.m(a,i),C(a,o,i),t=!0},p(a,i){i&8&&F(e,e=a[3])?(N(),b(n,1,1,be),P(),n=te(a),n.c(),_(n,1),n.m(o.parentNode,o)):n.p(a,i)},i(a){t||(_(n),t=!0)},o(a){b(n),t=!1},d(a){a&&S(o),n.d(a)}}}function te(l){let e,o;return e=new ve({props:{sourceOverride:{source:"pmtilesSource",sourceLayer:"rnet"},controls:l[4]}}),{c(){E(e.$$.fragment)},m(t,n){O(e,t,n),o=!0},p(t,n){const a={};n&16&&(a.controls=t[4]),e.$set(a)},i(t){o||(_(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){D(e,t)}}}function Me(l){let e,o,t=l[3]&&ee(l);return{c(){t&&t.c(),e=ae()},m(n,a){t&&t.m(n,a),C(n,e,a),o=!0},p(n,a){n[3]?t?(t.p(n,a),a&8&&_(t,1)):(t=ee(n),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(N(),b(t,1,1,()=>{t=null}),P())},i(n){o||(_(t),o=!0)},o(n){b(t),o=!1},d(n){n&&S(e),t&&t.d(n)}}}function oe(l){let e,o,t;function n(i){l[9](i)}let a={map:l[1],pmtiles:l[2]};return l[3]!==void 0&&(a.outputMetadata=l[3]),e=new ye({props:a}),R.push(()=>G(e,"outputMetadata",n)),{c(){E(e.$$.fragment)},m(i,p){O(e,i,p),t=!0},p(i,p){const r={};p&2&&(r.map=i[1]),p&4&&(r.pmtiles=i[2]),!o&&p&8&&(o=!0,r.outputMetadata=i[3],J(()=>o=!1)),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Ce(l){let e,o,t,n,a;function i(s){l[7](s)}let p={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,images:[{id:"chevron",url:Ae}],$$slots:{default:[Me]},$$scope:{ctx:l}};l[1]!==void 0&&(p.map=l[1]),o=new ce({props:p}),R.push(()=>G(o,"map",i)),o.$on("error",l[8]);let r=l[1]&&oe(l);return{c(){e=g("div"),E(o.$$.fragment),n=I(),r&&r.c(),z(e,"slot","main"),Y(e,"position","relative"),Y(e,"width","100%"),Y(e,"height","100vh")},m(s,f){C(s,e,f),O(o,e,null),m(e,n),r&&r.m(e,null),a=!0},p(s,f){const u={};f&8216&&(u.$$scope={dirty:f,ctx:s}),!t&&f&2&&(t=!0,u.map=s[1],J(()=>t=!1)),o.$set(u),s[1]?r?(r.p(s,f),f&2&&_(r,1)):(r=oe(s),r.c(),_(r,1),r.m(e,null)):r&&(N(),b(r,1,1,()=>{r=null}),P())},i(s){a||(_(o.$$.fragment,s),_(r),a=!0)},o(s){b(o.$$.fragment,s),b(r),a=!1},d(s){s&&S(e),D(o),r&&r.d()}}}function Se(l){let e,o;return e=new se({props:{$$slots:{main:[Ce],left:[$e]},$$scope:{ctx:l}}}),{c(){E(e.$$.fragment)},m(t,n){O(e,t,n),o=!0},p(t,[n]){const a={};n&8255&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(_(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){D(e,t)}}}function Le(l,e,o){ue(async()=>{await de()});let t,n,a="",i,p={maxCount:1e3,originRadius:3,destinationRadius:3,streetviewOn:!1},r;function s(c){try{o(0,a="");let A=r.files;o(2,n=new X(new _e(A[0])))}catch(A){window.alert(`Problem loading this PMTiles file. Don't open the GeoJSON file; make sure to select .pmtiles. Error: ${A}`)}}function f(c){t=c,o(1,t)}const u=c=>console.log(c.detail);function w(c){i=c,o(3,i)}function k(c){R[c?"unshift":"push"](()=>{r=c,o(5,r)})}function y(){a=ge(this),o(0,a)}function $(c){p=c,o(4,p)}return l.$$.update=()=>{l.$$.dirty&1&&a!=""&&o(2,n=new X(`https://assets.od2net.org/output/${a}.pmtiles`))},[a,t,n,i,p,r,s,f,u,w,k,y,$]}class Qe extends ne{constructor(e){super(),le(this,e,Le,Se,F,{})}}new Qe({target:document.getElementById("app")});
