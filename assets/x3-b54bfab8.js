import{S as fe,i as pe,s as ue,ab as I,e as b,f as q,z as E,l as w,E as x,v as k,ac as ee,g as G,n as h,a6 as $e,L as ge,c as L,a as j,t as y,b as C,d as B,o as be,H as he,x as D,y as V,h as K,q as ce,A as X,r as _e,u as me,M as we,_ as ke,$ as ye,a3 as F,ad as te,C as ve,j as Z,k as Ce,p as ne,ae as Q,a9 as de,aa as N,a2 as Se,a0 as R,a4 as Fe,a5 as Le}from"./Legend-52595ab8.js";import{C as je,_ as Be,J as Me,a as Ne,G as qe}from"./CostFunction-88c358f3.js";function le(o,e,n){const t=o.slice();return t[2]=e[n],t}function se(o,e,n){const t=o.slice();return t[5]=e[n],t}function oe(o){let e,n;return{c(){e=b("span"),n=G(`Â 
    `),E(e,"background",o[5]),E(e,"width","100%"),E(e,"border","1px solid black")},m(t,s){w(t,e,s),h(e,n)},p(t,s){s&1&&E(e,"background",t[5])},d(t){t&&k(e)}}}function ae(o){let e,n=o[2].toFixed(1)+"",t;return{c(){e=b("span"),t=G(n)},m(s,l){w(s,e,l),h(e,t)},p(s,l){l&2&&n!==(n=s[2].toFixed(1)+"")&&$e(t,n)},d(s){s&&k(e)}}}function Oe(o){let e,n,t,s=I(o[0]),l=[];for(let a=0;a<s.length;a+=1)l[a]=oe(se(o,s,a));let p=I(o[1]),r=[];for(let a=0;a<p.length;a+=1)r[a]=ae(le(o,p,a));return{c(){e=b("div");for(let a=0;a<l.length;a+=1)l[a].c();n=q(),t=b("div");for(let a=0;a<r.length;a+=1)r[a].c();E(e,"display","flex"),E(t,"display","flex"),E(t,"justify-content","space-between")},m(a,m){w(a,e,m);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(e,null);w(a,n,m),w(a,t,m);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(t,null)},p(a,[m]){if(m&1){s=I(a[0]);let i;for(i=0;i<s.length;i+=1){const _=se(a,s,i);l[i]?l[i].p(_,m):(l[i]=oe(_),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=s.length}if(m&2){p=I(a[1]);let i;for(i=0;i<p.length;i+=1){const _=le(a,p,i);r[i]?r[i].p(_,m):(r[i]=ae(_),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=p.length}},i:x,o:x,d(a){a&&(k(e),k(n),k(t)),ee(l,a),ee(r,a)}}}function Ee(o,e,n){let{colorScale:t}=e,{limits:s}=e;return o.$$set=l=>{"colorScale"in l&&n(0,t=l.colorScale),"limits"in l&&n(1,s=l.limits)},[t,s]}class Je extends fe{constructor(e){super(),pe(this,e,Ee,Oe,ue,{colorScale:0,limits:1})}}function ie(o){let e,n,t,s,l,p,r,a,m,i,_,d,M,J,O,S,T,H,P,$;const g=[He,Te],v=[];function A(f,c){return f[5]=="lts"?0:1}_=A(o),d=v[_]=g[_](o);function U(f){o[17](f)}let u={};return o[1]!==void 0&&(u.cost=o[1]),S=new Ne({props:u}),D.push(()=>V(S,"cost",U)),{c(){e=b("hr"),n=q(),t=b("div"),s=b("label"),l=G(`Color edges by:
          `),p=b("select"),r=b("option"),r.textContent="LTS",a=b("option"),a.textContent="Edge cost (relative to length)",m=b("option"),m.textContent="Nearby amenities",i=q(),d.c(),M=q(),J=b("hr"),O=q(),L(S.$$.fragment),r.__value="lts",Z(r,r.__value),a.__value="cost",Z(a,a.__value),m.__value="nearby_amenities",Z(m,m.__value),o[5]===void 0&&Ce(()=>o[16].call(p))},m(f,c){w(f,e,c),w(f,n,c),w(f,t,c),h(t,s),h(s,l),h(s,p),h(p,r),h(p,a),h(p,m),ne(p,o[5],!0),w(f,i,c),v[_].m(f,c),w(f,M,c),w(f,J,c),w(f,O,c),j(S,f,c),H=!0,P||($=ce(p,"change",o[16]),P=!0)},p(f,c){c&32&&ne(p,f[5]);let W=_;_=A(f),_===W?v[_].p(f,c):(_e(),C(v[W],1,1,()=>{v[W]=null}),me(),d=v[_],d?d.p(f,c):(d=v[_]=g[_](f),d.c()),y(d,1),d.m(M.parentNode,M));const Y={};!T&&c&2&&(T=!0,Y.cost=f[1],X(()=>T=!1)),S.$set(Y)},i(f){H||(y(d),y(S.$$.fragment,f),H=!0)},o(f){C(d),C(S.$$.fragment,f),H=!1},d(f){f&&(k(e),k(n),k(t),k(i),k(M),k(J),k(O)),v[_].d(f),B(S,f),P=!1,$()}}}function Te(o){let e,n,t,s;return e=new Je({props:{colorScale:Q,limits:z(o[5],o[7],o[8])}}),t=new de({props:{rows:[[N.lts_not_allowed,F.lts_not_allowed]]}}),{c(){L(e.$$.fragment),n=q(),L(t.$$.fragment)},m(l,p){j(e,l,p),w(l,n,p),j(t,l,p),s=!0},p(l,p){const r={};p&416&&(r.limits=z(l[5],l[7],l[8])),e.$set(r)},i(l){s||(y(e.$$.fragment,l),y(t.$$.fragment,l),s=!0)},o(l){C(e.$$.fragment,l),C(t.$$.fragment,l),s=!1},d(l){l&&k(n),B(e,l),B(t,l)}}}function He(o){let e,n,t,s;return e=new de({props:{rows:[[`${N.lts1}: ${o[6][1].toFixed(0)}% of roads by distance`,F.lts1],[`${N.lts2}: ${o[6][2].toFixed(0)}%`,F.lts2],[`${N.lts3}: ${o[6][3].toFixed(0)}%`,F.lts3],[`${N.lts4}: ${o[6][4].toFixed(0)}%`,F.lts4],[N.lts_not_allowed,F.lts_not_allowed]]}}),{c(){L(e.$$.fragment),n=q(),t=b("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(l,p){j(e,l,p),w(l,n,p),w(l,t,p),s=!0},p(l,p){const r={};p&64&&(r.rows=[[`${N.lts1}: ${l[6][1].toFixed(0)}% of roads by distance`,F.lts1],[`${N.lts2}: ${l[6][2].toFixed(0)}%`,F.lts2],[`${N.lts3}: ${l[6][3].toFixed(0)}%`,F.lts3],[`${N.lts4}: ${l[6][4].toFixed(0)}%`,F.lts4],[N.lts_not_allowed,F.lts_not_allowed]]),e.$set(r)},i(l){s||(y(e.$$.fragment,l),s=!0)},o(l){C(e.$$.fragment,l),s=!1},d(l){l&&(k(n),k(t)),B(e,l)}}}function Pe(o){let e,n,t,s,l,p,r,a,m,i,_,d,M,J,O,S,T;n=new he({props:{app:"costs"}});function H(g){o[15](g)}let P={};o[0]!==void 0&&(P.example=o[0]),d=new je({props:P}),D.push(()=>V(d,"example",H));let $=o[3]&&ie(o);return{c(){e=b("div"),L(n.$$.fragment),t=q(),s=b("label"),l=G("Open a "),p=b("i"),p.textContent=".bin",r=G(" network file or an "),a=b("i"),a.textContent=".osm.pbf",m=q(),i=b("input"),_=q(),L(d.$$.fragment),J=q(),$&&$.c(),K(i,"type","file"),K(e,"slot","left")},m(g,v){w(g,e,v),j(n,e,null),h(e,t),h(e,s),h(s,l),h(s,p),h(s,r),h(s,a),h(s,m),h(s,i),o[14](i),h(e,_),j(d,e,null),h(e,J),$&&$.m(e,null),O=!0,S||(T=ce(i,"change",o[10]),S=!0)},p(g,v){const A={};!M&&v&1&&(M=!0,A.example=g[0],X(()=>M=!1)),d.$set(A),g[3]?$?($.p(g,v),v&8&&y($,1)):($=ie(g),$.c(),y($,1),$.m(e,null)):$&&(_e(),C($,1,1,()=>{$=null}),me())},i(g){O||(y(n.$$.fragment,g),y(d.$$.fragment,g),y($),O=!0)},o(g){C(n.$$.fragment,g),C(d.$$.fragment,g),C($),O=!1},d(g){g&&k(e),B(n),o[14](null),B(d),$&&$.d(),S=!1,T()}}}function Ae(o){let e,n;return e=new Le({props:{properties:o[22][0].properties}}),{c(){L(e.$$.fragment)},m(t,s){j(e,t,s),n=!0},p(t,s){const l={};s&4194304&&(l.properties=t[22][0].properties),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ge(o){let e,n;return e=new Fe({props:{openOn:"hover",$$slots:{default:[Ae,({features:t})=>({22:t}),({features:t})=>t?4194304:0]},$$scope:{ctx:o}}}),{c(){L(e.$$.fragment)},m(t,s){j(e,t,s),n=!0},p(t,s){const l={};s&12582912&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ie(o){let e,n;return e=new Se({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":o[11](o[5],o[7],o[8]),"line-opacity":o[5]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,R(1,.5)]:R(1,.5)},beforeId:"Road labels",$$slots:{default:[Ge]},$$scope:{ctx:o}}}),e.$on("click",o[12]),{c(){L(e.$$.fragment)},m(t,s){j(e,t,s),n=!0},p(t,s){const l={};s&416&&(l.paint={"line-width":5,"line-color":t[11](t[5],t[7],t[8]),"line-opacity":t[5]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,R(1,.5)]:R(1,.5)}),s&8388608&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Re(o){let e,n;return e=new qe({props:{data:o[4],$$slots:{default:[Ie]},$$scope:{ctx:o}}}),{c(){L(e.$$.fragment)},m(t,s){j(e,t,s),n=!0},p(t,s){const l={};s&16&&(l.data=t[4]),s&8389024&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function ze(o){let e,n,t,s;function l(r){o[13](r)}let p={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Re]},$$scope:{ctx:o}};return o[2]!==void 0&&(p.map=o[2]),n=new we({props:p}),D.push(()=>V(n,"map",l)),{c(){e=b("div"),L(n.$$.fragment),K(e,"slot","main"),E(e,"position","relative"),E(e,"width","100%"),E(e,"height","100vh")},m(r,a){w(r,e,a),j(n,e,null),s=!0},p(r,a){const m={};a&8389040&&(m.$$scope={dirty:a,ctx:r}),!t&&a&4&&(t=!0,m.map=r[2],X(()=>t=!1)),n.$set(m)},i(r){s||(y(n.$$.fragment,r),s=!0)},o(r){C(n.$$.fragment,r),s=!1},d(r){r&&k(e),B(n)}}}function De(o){let e,n;return e=new ge({props:{$$slots:{main:[ze],left:[Pe]},$$scope:{ctx:o}}}),{c(){L(e.$$.fragment)},m(t,s){j(e,t,s),n=!0},p(t,[s]){const l={};s&8389631&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ue(o){let e=o.properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function z(o,e,n){if(o=="lts")return null;if(o=="cost")return re(0,e);if(o=="nearby_amenities")return re(0,n)}function re(o,e){let n=[],t=(e-o)/5;for(let s=0;s<6;s++)n.push(o+s*t);return n}function We(o,e,n){be(async()=>{await Be(),await ke()});let t,s,l="",p={type:"FeatureCollection",features:[]},r="Distance",a="cost",m=[0,0,0,0,0],i=1,_=1,d;async function M(u){n(0,l=""),J(await d.files[0].arrayBuffer())}function J(u){try{n(3,s=new Me(new Uint8Array(u)));let f=s.getBounds();t.fitBounds([[f[0],f[1]],[f[2],f[3]]],{padding:20,animate:!1}),S()}catch(f){window.alert(`Problem loading network file: ${f}`)}}async function O(u){if(u!=""){let f=await fetch(`https://assets.od2net.org/pbf_clips/${u}.osm.pbf`);J(await f.arrayBuffer())}}function S(){n(4,p=JSON.parse(s.debugNetwork()));let u=0,f=[0,0,0,0,0];n(7,i=0),n(8,_=0);for(let c of p.features)n(8,_=Math.max(_,c.properties.nearby_amenities)),c.properties.length&&(n(7,i=Math.max(i,c.properties.cost/c.properties.length)),u+=c.properties.length,f[c.properties.lts]+=c.properties.length);n(6,m=f.map(c=>c/u*100))}function T(u,f,c){if(u=="lts")return ye;if(u=="cost")return["case",["==",0,["get","lts"]],F.lts_not_allowed,te(["/",["get","cost"],["get","length"]],z(u,f,c),Q)];if(u=="nearby_amenities")return te(["get","nearby_amenities"],z(u,f,c),Q)}function H(u){s&&(s.updateCostFunction(u),S())}const P=u=>Ue(u.detail.features[0]);function $(u){t=u,n(2,t)}function g(u){D[u?"unshift":"push"](()=>{d=u,n(9,d)})}function v(u){l=u,n(0,l)}function A(){a=ve(this),n(5,a)}function U(u){r=u,n(1,r)}return o.$$.update=()=>{o.$$.dirty&1&&O(l),o.$$.dirty&2&&H(r)},[l,r,t,s,p,a,m,i,_,d,M,T,P,$,g,v,A,U]}class Ze extends fe{constructor(e){super(),pe(this,e,We,De,ue,{})}}new Ze({target:document.getElementById("app")});
