import{S as ge,i as $e,s as he,aa as R,e as m,f as F,z as y,l as T,E as re,v as j,ab as oe,g as H,n as c,a6 as ve,L as ye,c as S,a as L,t as h,b,d as C,o as Se,H as Le,x as Y,y as be,h as V,j as Q,k as Ce,p as ie,q as ue,r as Fe,u as Te,A as we,w as je,M as qe,_ as Oe,$ as Me,ac as fe,C as Ne,ad as X,a9 as Be,a3 as N,a2 as Ee,a0 as z,a4 as Je,a5 as He}from"./Legend-4afc4d67.js";import{C as Ae,_ as Ge,J as Ie,G as Pe}from"./CostFunction-81a91059.js";function ce(a,e,n){const t=a.slice();return t[2]=e[n],t}function pe(a,e,n){const t=a.slice();return t[5]=e[n],t}function _e(a){let e,n;return{c(){e=m("span"),n=H(`Â 
    `),y(e,"background",a[5]),y(e,"width","100%"),y(e,"border","1px solid black")},m(t,l){T(t,e,l),c(e,n)},p(t,l){l&1&&y(e,"background",t[5])},d(t){t&&j(e)}}}function me(a){let e,n=a[2]+"",t;return{c(){e=m("span"),t=H(n)},m(l,s){T(l,e,s),c(e,t)},p(l,s){s&2&&n!==(n=l[2]+"")&&ve(t,n)},d(l){l&&j(e)}}}function Re(a){let e,n,t,l=R(a[0]),s=[];for(let r=0;r<l.length;r+=1)s[r]=_e(pe(a,l,r));let f=R(a[1]),i=[];for(let r=0;r<f.length;r+=1)i[r]=me(ce(a,f,r));return{c(){e=m("div");for(let r=0;r<s.length;r+=1)s[r].c();n=F(),t=m("div");for(let r=0;r<i.length;r+=1)i[r].c();y(e,"display","flex"),y(t,"display","flex"),y(t,"justify-content","space-between")},m(r,p){T(r,e,p);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null);T(r,n,p),T(r,t,p);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(t,null)},p(r,[p]){if(p&1){l=R(r[0]);let o;for(o=0;o<l.length;o+=1){const w=pe(r,l,o);s[o]?s[o].p(w,p):(s[o]=_e(w),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}if(p&2){f=R(r[1]);let o;for(o=0;o<f.length;o+=1){const w=ce(r,f,o);i[o]?i[o].p(w,p):(i[o]=me(w),i[o].c(),i[o].m(t,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=f.length}},i:re,o:re,d(r){r&&(j(e),j(n),j(t)),oe(s,r),oe(i,r)}}}function ze(a,e,n){let{colorScale:t}=e,{limits:l}=e;return a.$$set=s=>{"colorScale"in s&&n(0,t=s.colorScale),"limits"in s&&n(1,l=s.limits)},[t,l]}class De extends ge{constructor(e){super(),$e(this,e,ze,Re,he,{colorScale:0,limits:1})}}function Ue(a){let e,n;return e=new De({props:{colorScale:X,limits:D(a[3])}}),{c(){S(e.$$.fragment)},m(t,l){L(e,t,l),n=!0},p(t,l){const s={};l&8&&(s.limits=D(t[3])),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function We(a){let e,n,t,l;return e=new Be({props:{rows:[[`LTS 1 - suitable for children: ${a[4][1].toFixed(0)}%`,N.lts1],[`LTS 2 - low stress: ${a[4][2].toFixed(0)}%`,N.lts2],[`LTS 3 - medium stress: ${a[4][3].toFixed(0)}%`,N.lts3],[`LTS 4 - high stress: ${a[4][4].toFixed(0)}%`,N.lts4]]}}),{c(){S(e.$$.fragment),n=F(),t=m("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,f){L(e,s,f),T(s,n,f),T(s,t,f),l=!0},p(s,f){const i={};f&16&&(i.rows=[[`LTS 1 - suitable for children: ${s[4][1].toFixed(0)}%`,N.lts1],[`LTS 2 - low stress: ${s[4][2].toFixed(0)}%`,N.lts2],[`LTS 3 - medium stress: ${s[4][3].toFixed(0)}%`,N.lts3],[`LTS 4 - high stress: ${s[4][4].toFixed(0)}%`,N.lts4]]),e.$set(i)},i(s){l||(h(e.$$.fragment,s),l=!0)},o(s){b(e.$$.fragment,s),l=!1},d(s){s&&(j(n),j(t)),C(e,s)}}}function Ze(a){let e,n,t,l,s,f,i,r,p,o,w,A,G,J,E,I,k,q,u,g,d,$,v,U,x,ee,O,W,P,Z,te;n=new Le({props:{app:"costs"}});const ne=[We,Ue],M=[];function le(_,B){return _[3]=="lts"?0:1}$=le(a),v=M[$]=ne[$](a);function ke(_){a[12](_)}let se={};return a[0]!==void 0&&(se.cost=a[0]),O=new Ae({props:se}),Y.push(()=>be(O,"cost",ke)),{c(){e=m("div"),S(n.$$.fragment),t=F(),l=m("label"),s=H("Open a "),f=m("i"),f.textContent=".bin",i=H(" network file or an "),r=m("i"),r.textContent=".osm.pbf",p=F(),o=m("input"),w=F(),A=m("hr"),G=F(),J=m("div"),E=m("label"),I=H(`Color edges by:
        `),k=m("select"),q=m("option"),q.textContent="LTS",u=m("option"),u.textContent="Edge cost (relative to length)",g=m("option"),g.textContent="Nearby amenities",d=F(),v.c(),U=F(),x=m("hr"),ee=F(),S(O.$$.fragment),V(o,"type","file"),q.__value="lts",Q(q,q.__value),u.__value="cost",Q(u,u.__value),g.__value="nearby_amenities",Q(g,g.__value),a[3]===void 0&&Ce(()=>a[11].call(k)),V(e,"slot","left")},m(_,B){T(_,e,B),L(n,e,null),c(e,t),c(e,l),c(l,s),c(l,f),c(l,i),c(l,r),c(l,p),c(l,o),a[10](o),c(e,w),c(e,A),c(e,G),c(e,J),c(J,E),c(E,I),c(E,k),c(k,q),c(k,u),c(k,g),ie(k,a[3],!0),c(e,d),M[$].m(e,null),c(e,U),c(e,x),c(e,ee),L(O,e,null),P=!0,Z||(te=[ue(o,"change",a[6]),ue(k,"change",a[11])],Z=!0)},p(_,B){B&8&&ie(k,_[3]);let K=$;$=le(_),$===K?M[$].p(_,B):(Fe(),b(M[K],1,1,()=>{M[K]=null}),Te(),v=M[$],v?v.p(_,B):(v=M[$]=ne[$](_),v.c()),h(v,1),v.m(e,U));const ae={};!W&&B&1&&(W=!0,ae.cost=_[0],we(()=>W=!1)),O.$set(ae)},i(_){P||(h(n.$$.fragment,_),h(v),h(O.$$.fragment,_),P=!0)},o(_){b(n.$$.fragment,_),b(v),b(O.$$.fragment,_),P=!1},d(_){_&&j(e),C(n),a[10](null),M[$].d(),C(O),Z=!1,je(te)}}}function Ke(a){let e,n;return e=new He({props:{properties:a[16][0].properties}}),{c(){S(e.$$.fragment)},m(t,l){L(e,t,l),n=!0},p(t,l){const s={};l&65536&&(s.properties=t[16][0].properties),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Qe(a){let e,n;return e=new Je({props:{openOn:"hover",$$slots:{default:[Ke,({features:t})=>({16:t}),({features:t})=>t?65536:0]},$$scope:{ctx:a}}}),{c(){S(e.$$.fragment)},m(t,l){L(e,t,l),n=!0},p(t,l){const s={};l&196608&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Ve(a){let e,n;return e=new Ee({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":a[7](a[3]),"line-opacity":a[3]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,z(1,.5)]:z(1,.5)},beforeId:"Road labels",$$slots:{default:[Qe]},$$scope:{ctx:a}}}),e.$on("click",a[8]),{c(){S(e.$$.fragment)},m(t,l){L(e,t,l),n=!0},p(t,l){const s={};l&8&&(s.paint={"line-width":5,"line-color":t[7](t[3]),"line-opacity":t[3]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,z(1,.5)]:z(1,.5)}),l&131072&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Xe(a){let e,n;return e=new Pe({props:{data:a[2],$$slots:{default:[Ve]},$$scope:{ctx:a}}}),{c(){S(e.$$.fragment)},m(t,l){L(e,t,l),n=!0},p(t,l){const s={};l&4&&(s.data=t[2]),l&131080&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function Ye(a){let e,n,t,l;function s(i){a[9](i)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Xe]},$$scope:{ctx:a}};return a[1]!==void 0&&(f.map=a[1]),n=new qe({props:f}),Y.push(()=>be(n,"map",s)),{c(){e=m("div"),S(n.$$.fragment),V(e,"slot","main"),y(e,"position","relative"),y(e,"width","100%"),y(e,"height","100vh")},m(i,r){T(i,e,r),L(n,e,null),l=!0},p(i,r){const p={};r&131084&&(p.$$scope={dirty:r,ctx:i}),!t&&r&2&&(t=!0,p.map=i[1],we(()=>t=!1)),n.$set(p)},i(i){l||(h(n.$$.fragment,i),l=!0)},o(i){b(n.$$.fragment,i),l=!1},d(i){i&&j(e),C(n)}}}function xe(a){let e,n;return e=new ye({props:{$$slots:{main:[Ye],left:[Ze]},$$scope:{ctx:a}}}),{c(){S(e.$$.fragment)},m(t,l){L(e,t,l),n=!0},p(t,[l]){const s={};l&131135&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t)}}}function et(a){let e=a.properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function D(a){if(a=="lts")return null;if(a=="cost")return de(1,30);if(a=="nearby_amenities")return de(0,20)}function de(a,e){let n=[],t=(e-a)/5;for(let l=0;l<6;l++)n.push(a+l*t);return n}function tt(a,e,n){Se(async()=>{await Ge(),await Oe()});let t,l,s={type:"FeatureCollection",features:[]},f="Distance",i="cost",r=[0,0,0,0,0],p;async function o(u){try{let g=await p.files[0].arrayBuffer();l=new Ie(new Uint8Array(g));let d=l.getBounds();t.fitBounds([[d[0],d[1]],[d[2],d[3]]],{padding:20,animate:!1}),w()}catch(g){window.alert(`Problem loading network file: ${g}`)}}function w(){n(2,s=JSON.parse(l.debugNetwork()));let u=0,g=[0,0,0,0,0];for(let d of s.features)d.properties.length&&(u+=d.properties.length,g[d.properties.lts]+=d.properties.length);n(4,r=g.map(d=>d/u*100))}function A(u){if(u=="lts")return Me;if(u=="cost")return fe(["/",["get","cost"],["get","length"]],D(u),X);if(u=="nearby_amenities")return fe(["get","nearby_amenities"],D(u),X)}function G(u){l&&(l.updateCostFunction(u),w())}const J=u=>et(u.detail.features[0]);function E(u){t=u,n(1,t)}function I(u){Y[u?"unshift":"push"](()=>{p=u,n(5,p)})}function k(){i=Ne(this),n(3,i)}function q(u){f=u,n(0,f)}return a.$$.update=()=>{a.$$.dirty&1&&G(f)},[f,t,s,i,r,p,o,A,J,E,I,k,q]}class nt extends ge{constructor(e){super(),$e(this,e,tt,xe,he,{})}}new nt({target:document.getElementById("app")});
