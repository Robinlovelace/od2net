import{S as ee,i as te,s as T,m as ie,P as re,L as ue,c as E,a as O,t as _,b as h,d as N,o as se,e as d,f as z,g as F,h as J,j as L,k as fe,l as S,n as m,p as K,q as W,r as I,u as R,v as P,w as pe,M as me,x as j,y as oe,z as B,A as ne,_ as ce,B as Y,F as de,C as _e,D as be,E as ae,G as le,H as ge}from"./SidebarControls-5f9dc64b.js";let D="pmtilesSource";async function he(a){let e=await a.getHeader(),n=await a.getMetadata();return{bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],outputMetadata:JSON.parse(n.description),minZoom:e.minZoom,maxZoom:e.maxZoom}}function ve(a,e,n){let{pmtiles:t}=e,{map:o}=e,{outputMetadata:l=null}=e,u=new re;ie.addProtocol("pmtiles",u.tile);async function b(i){r(D),u.add(i);let f=await he(i);o.addSource(D,{type:"vector",tiles:["pmtiles://"+i.source.getKey()+"/{z}/{x}/{y}"],minzoom:f.minZoom,maxzoom:f.maxZoom,bounds:f.bounds}),o.fitBounds(f.bounds,{padding:100,duration:500}),n(0,l=f.outputMetadata)}function r(i){if(o.getSource(i)){let f=[];for(let s of o.getStyle().layers)"source"in s&&s.source==i&&f.push(s.id);for(let s of f)o.removeLayer(s);o.removeSource(i)}}return a.$$set=i=>{"pmtiles"in i&&n(1,t=i.pmtiles),"map"in i&&n(2,o=i.map),"outputMetadata"in i&&n(0,l=i.outputMetadata)},a.$$.update=()=>{a.$$.dirty&2&&(t?b(t):r(D))},[l,t,o]}class ye extends ee{constructor(e){super(),te(this,e,ve,null,T,{pmtiles:1,map:2,outputMetadata:0})}}function Q(a){let e,n,t;return{c(){e=F("Open a "),n=d("i"),n.textContent=".pmtiles",t=F(` file produced by the tool. Note this file stays in
        your browser; it doesn't get uploaded anywhere.`)},m(o,l){S(o,e,l),S(o,n,l),S(o,t,l)},d(o){o&&(P(e),P(n),P(t))}}}function U(a){let e,n;return e=new be({props:{outputMetadata:a[3],map:a[0],controls:a[5]}}),{c(){E(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,o){const l={};o&8&&(l.outputMetadata=t[3]),o&1&&(l.map=t[0]),e.$set(l)},i(t){n||(_(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function we(a){let e,n,t,o,l,u,b,r,i,f,s,w,k,p,v,M,$,C,G,q,A,H,g=a[2]==null&&Q(),c=a[3]&&U(a);return{c(){e=d("div"),n=d("h1"),n.textContent="od2net",t=z(),o=d("label"),g&&g.c(),l=z(),u=d("input"),b=z(),r=d("div"),i=d("label"),f=F(`Or load an example:
        `),s=d("select"),w=d("option"),w.textContent="Custom file loaded",k=d("option"),k.textContent="Edinburgh",p=d("option"),p.textContent="England (2011 home-to-work)",v=d("option"),v.textContent="Liverpool",M=d("option"),M.textContent="London",$=d("option"),$.textContent="Seattle",C=d("option"),C.textContent="York",G=z(),c&&c.c(),J(u,"type","file"),w.__value="",L(w,w.__value),k.__value="edinburgh",L(k,k.__value),p.__value="england_2011_home_to_work",L(p,p.__value),v.__value="liverpool",L(v,v.__value),M.__value="london",L(M,M.__value),$.__value="seattle",L($,$.__value),C.__value="york",L(C,C.__value),a[1]===void 0&&fe(()=>a[10].call(s)),J(e,"slot","left")},m(y,Z){S(y,e,Z),m(e,n),m(e,t),m(e,o),g&&g.m(o,null),m(o,l),m(o,u),a[9](u),m(e,b),m(e,r),m(r,i),m(i,f),m(i,s),m(s,w),m(s,k),m(s,p),m(s,v),m(s,M),m(s,$),m(s,C),K(s,a[1],!0),m(e,G),c&&c.m(e,null),q=!0,A||(H=[W(u,"change",a[6]),W(s,"change",a[10])],A=!0)},p(y,Z){y[2]==null?g||(g=Q(),g.c(),g.m(o,l)):g&&(g.d(1),g=null),Z&2&&K(s,y[1]),y[3]?c?(c.p(y,Z),Z&8&&_(c,1)):(c=U(y),c.c(),_(c,1),c.m(e,null)):c&&(I(),h(c,1,1,()=>{c=null}),R())},i(y){q||(_(c),q=!0)},o(y){h(c),q=!1},d(y){y&&P(e),g&&g.d(),a[9](null),c&&c.d(),A=!1,pe(H)}}}function V(a){let e=a[3],n,t,o=X(a);return{c(){o.c(),n=ae()},m(l,u){o.m(l,u),S(l,n,u),t=!0},p(l,u){u&8&&T(e,e=l[3])?(I(),h(o,1,1,le),R(),o=X(l),o.c(),_(o,1),o.m(n.parentNode,n)):o.p(l,u)},i(l){t||(_(o),t=!0)},o(l){h(o),t=!1},d(l){l&&P(n),o.d(l)}}}function X(a){let e,n;return e=new ge({props:{sourceOverride:{source:"pmtilesSource",sourceLayer:"rnet"},controls:a[5]}}),{c(){E(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p:le,i(t){n||(_(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function ke(a){let e,n,t=a[3]&&V(a);return{c(){t&&t.c(),e=ae()},m(o,l){t&&t.m(o,l),S(o,e,l),n=!0},p(o,l){o[3]?t?(t.p(o,l),l&8&&_(t,1)):(t=V(o),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(I(),h(t,1,1,()=>{t=null}),R())},i(o){n||(_(t),n=!0)},o(o){h(t),n=!1},d(o){o&&P(e),t&&t.d(o)}}}function x(a){let e,n,t;function o(u){a[8](u)}let l={map:a[0],pmtiles:a[2]};return a[3]!==void 0&&(l.outputMetadata=a[3]),e=new ye({props:l}),j.push(()=>oe(e,"outputMetadata",o)),{c(){E(e.$$.fragment)},m(u,b){O(e,u,b),t=!0},p(u,b){const r={};b&1&&(r.map=u[0]),b&4&&(r.pmtiles=u[2]),!n&&b&8&&(n=!0,r.outputMetadata=u[3],ne(()=>n=!1)),e.$set(r)},i(u){t||(_(e.$$.fragment,u),t=!0)},o(u){h(e.$$.fragment,u),t=!1},d(u){N(e,u)}}}function Me(a){let e,n,t,o,l;function u(i){a[7](i)}let b={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[ke]},$$scope:{ctx:a}};a[0]!==void 0&&(b.map=a[0]),n=new me({props:b}),j.push(()=>oe(n,"map",u));let r=a[0]&&x(a);return{c(){e=d("div"),E(n.$$.fragment),o=z(),r&&r.c(),J(e,"slot","main"),B(e,"position","relative"),B(e,"width","100%"),B(e,"height","100vh")},m(i,f){S(i,e,f),O(n,e,null),m(e,o),r&&r.m(e,null),l=!0},p(i,f){const s={};f&2056&&(s.$$scope={dirty:f,ctx:i}),!t&&f&1&&(t=!0,s.map=i[0],ne(()=>t=!1)),n.$set(s),i[0]?r?(r.p(i,f),f&1&&_(r,1)):(r=x(i),r.c(),_(r,1),r.m(e,null)):r&&(I(),h(r,1,1,()=>{r=null}),R())},i(i){l||(_(n.$$.fragment,i),_(r),l=!0)},o(i){h(n.$$.fragment,i),h(r),l=!1},d(i){i&&P(e),N(n),r&&r.d()}}}function $e(a){let e,n;return e=new ue({props:{$$slots:{main:[Me],left:[we]},$$scope:{ctx:a}}}),{c(){E(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,[o]){const l={};o&2079&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(_(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function Ce(a,e,n){se(async()=>{await ce()});let t,o,l="",u,b={maxCount:1e3,originRadius:3,destinationRadius:3,streetviewOn:!1},r;function i(p){try{n(1,l="");let v=r.files;n(2,o=new Y(new de(v[0])))}catch(v){window.alert(`Problem loading this PMTiles file. Don't open the GeoJSON file; make sure to select .pmtiles. Error: ${v}`)}}function f(p){t=p,n(0,t)}function s(p){u=p,n(3,u)}function w(p){j[p?"unshift":"push"](()=>{r=p,n(4,r)})}function k(){l=_e(this),n(1,l)}return a.$$.update=()=>{a.$$.dirty&2&&l!=""&&n(2,o=new Y(`http://od2net.s3-website.eu-west-2.amazonaws.com/output/${l}.pmtiles`)),a.$$.dirty&1&&t&&t.on("moveend",()=>{let p=[];for(let C of t.queryRenderedFeatures(void 0,{layers:["input-layer"]}))p.push(C.properties.count);let v=Math.min(...p),M=Math.max(...p),$=p.length;console.log({min:v,max:M,count:$})})},[t,l,o,u,r,b,i,f,s,w,k]}class Le extends ee{constructor(e){super(),te(this,e,Ce,$e,T,{})}}new Le({target:document.getElementById("app")});
