import{S as se,i as ae,s as re,V as J,e as m,f as B,z as y,l as S,E as X,v as L,W as Z,g as A,n as p,X as oe,L as ue,c as C,a as T,t as b,b as w,d as F,o as fe,H as ce,h as G,j as z,k as pe,p as K,q as Q,r as _e,u as me,w as de,M as ge,x as ie,y as $e,A as he,_ as be,a2 as we,ac as Y,C as ke,ad as W,ab as ve,a6 as O,a5 as ye,a3 as H,a7 as Se,a8 as Le}from"./Legend-2db49f7e.js";import{_ as Ce,J as Te,G as Fe}from"./@vite-plugin-wasm-pack@wasm-od2net-8cae2080.js";function x(a,e,n){const t=a.slice();return t[2]=e[n],t}function ee(a,e,n){const t=a.slice();return t[5]=e[n],t}function te(a){let e,n;return{c(){e=m("span"),n=A(`Â 
    `),y(e,"background",a[5]),y(e,"width","100%"),y(e,"border","1px solid black")},m(t,l){S(t,e,l),p(e,n)},p(t,l){l&1&&y(e,"background",t[5])},d(t){t&&L(e)}}}function ne(a){let e,n=a[2]+"",t;return{c(){e=m("span"),t=A(n)},m(l,s){S(l,e,s),p(e,t)},p(l,s){s&2&&n!==(n=l[2]+"")&&oe(t,n)},d(l){l&&L(e)}}}function je(a){let e,n,t,l=J(a[0]),s=[];for(let r=0;r<l.length;r+=1)s[r]=te(ee(a,l,r));let u=J(a[1]),o=[];for(let r=0;r<u.length;r+=1)o[r]=ne(x(a,u,r));return{c(){e=m("div");for(let r=0;r<s.length;r+=1)s[r].c();n=B(),t=m("div");for(let r=0;r<o.length;r+=1)o[r].c();y(e,"display","flex"),y(t,"display","flex"),y(t,"justify-content","space-between")},m(r,c){S(r,e,c);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);S(r,n,c),S(r,t,c);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(t,null)},p(r,[c]){if(c&1){l=J(r[0]);let i;for(i=0;i<l.length;i+=1){const k=ee(r,l,i);s[i]?s[i].p(k,c):(s[i]=te(k),s[i].c(),s[i].m(e,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=l.length}if(c&2){u=J(r[1]);let i;for(i=0;i<u.length;i+=1){const k=x(r,u,i);o[i]?o[i].p(k,c):(o[i]=ne(k),o[i].c(),o[i].m(t,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=u.length}},i:X,o:X,d(r){r&&(L(e),L(n),L(t)),Z(s,r),Z(o,r)}}}function qe(a,e,n){let{colorScale:t}=e,{limits:l}=e;return a.$$set=s=>{"colorScale"in s&&n(0,t=s.colorScale),"limits"in s&&n(1,l=s.limits)},[t,l]}class Oe extends se{constructor(e){super(),ae(this,e,qe,je,re,{colorScale:0,limits:1})}}function Me(a){let e,n;return e=new Oe({props:{colorScale:W,limits:I(a[2])}}),{c(){C(e.$$.fragment)},m(t,l){T(e,t,l),n=!0},p(t,l){const s={};l&4&&(s.limits=I(t[2])),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ne(a){let e,n,t,l;return e=new ve({props:{rows:[[`LTS 1 - suitable for children: ${a[3][1].toFixed(0)}%`,O.lts1],[`LTS 2 - low stress: ${a[3][2].toFixed(0)}%`,O.lts2],[`LTS 3 - medium stress: ${a[3][3].toFixed(0)}%`,O.lts3],[`LTS 4 - high stress: ${a[3][4].toFixed(0)}%`,O.lts4]]}}),{c(){C(e.$$.fragment),n=B(),t=m("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,u){T(e,s,u),S(s,n,u),S(s,t,u),l=!0},p(s,u){const o={};u&8&&(o.rows=[[`LTS 1 - suitable for children: ${s[3][1].toFixed(0)}%`,O.lts1],[`LTS 2 - low stress: ${s[3][2].toFixed(0)}%`,O.lts2],[`LTS 3 - medium stress: ${s[3][3].toFixed(0)}%`,O.lts3],[`LTS 4 - high stress: ${s[3][4].toFixed(0)}%`,O.lts4]]),e.$set(o)},i(s){l||(b(e.$$.fragment,s),l=!0)},o(s){w(e.$$.fragment,s),l=!1},d(s){s&&(L(n),L(t)),F(e,s)}}}function Be(a){let e,n,t,l,s,u,o,r,c,i,k,E,$,j,f,v,M,_,d,h,P,D;n=new ce({props:{app:"costs"}});const U=[Ne,Me],q=[];function V(g,N){return g[2]=="lts"?0:1}return _=V(a),d=q[_]=U[_](a),{c(){e=m("div"),C(n.$$.fragment),t=B(),l=m("label"),s=A("Open a "),u=m("i"),u.textContent=".bin",o=A(" network file or an "),r=m("i"),r.textContent=".osm.pbf",c=B(),i=m("input"),k=B(),E=m("div"),$=m("select"),j=m("option"),j.textContent="LTS",f=m("option"),f.textContent="Edge cost (relative to length)",v=m("option"),v.textContent="Nearby amenities",M=B(),d.c(),G(i,"type","file"),j.__value="lts",z(j,j.__value),f.__value="cost",z(f,f.__value),v.__value="nearby_amenities",z(v,v.__value),a[2]===void 0&&pe(()=>a[10].call($)),G(e,"slot","left")},m(g,N){S(g,e,N),T(n,e,null),p(e,t),p(e,l),p(l,s),p(l,u),p(l,o),p(l,r),p(l,c),p(l,i),a[9](i),p(e,k),p(e,E),p(E,$),p($,j),p($,f),p($,v),K($,a[2],!0),p(e,M),q[_].m(e,null),h=!0,P||(D=[Q(i,"change",a[5]),Q($,"change",a[10])],P=!0)},p(g,N){N&4&&K($,g[2]);let R=_;_=V(g),_===R?q[_].p(g,N):(_e(),w(q[R],1,1,()=>{q[R]=null}),me(),d=q[_],d?d.p(g,N):(d=q[_]=U[_](g),d.c()),b(d,1),d.m(e,null))},i(g){h||(b(n.$$.fragment,g),b(d),h=!0)},o(g){w(n.$$.fragment,g),w(d),h=!1},d(g){g&&L(e),F(n),a[9](null),q[_].d(),P=!1,de(D)}}}function Ee(a){let e,n;return e=new Le({props:{properties:a[12][0].properties}}),{c(){C(e.$$.fragment)},m(t,l){T(e,t,l),n=!0},p(t,l){const s={};l&4096&&(s.properties=t[12][0].properties),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Je(a){let e,n;return e=new Se({props:{openOn:"hover",$$slots:{default:[Ee,({features:t})=>({12:t}),({features:t})=>t?4096:0]},$$scope:{ctx:a}}}),{c(){C(e.$$.fragment)},m(t,l){T(e,t,l),n=!0},p(t,l){const s={};l&12288&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function He(a){let e,n;return e=new ye({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":a[6](a[2]),"line-opacity":a[2]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,H(1,.5)]:H(1,.5)},beforeId:"Road labels",$$slots:{default:[Je]},$$scope:{ctx:a}}}),e.$on("click",a[7]),{c(){C(e.$$.fragment)},m(t,l){T(e,t,l),n=!0},p(t,l){const s={};l&4&&(s.paint={"line-width":5,"line-color":t[6](t[2]),"line-opacity":t[2]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,H(1,.5)]:H(1,.5)}),l&8192&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ae(a){let e,n;return e=new Fe({props:{data:a[1],$$slots:{default:[He]},$$scope:{ctx:a}}}),{c(){C(e.$$.fragment)},m(t,l){T(e,t,l),n=!0},p(t,l){const s={};l&2&&(s.data=t[1]),l&8196&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ie(a){let e,n,t,l;function s(o){a[8](o)}let u={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ae]},$$scope:{ctx:a}};return a[0]!==void 0&&(u.map=a[0]),n=new ge({props:u}),ie.push(()=>$e(n,"map",s)),{c(){e=m("div"),C(n.$$.fragment),G(e,"slot","main"),y(e,"position","relative"),y(e,"width","100%"),y(e,"height","100vh")},m(o,r){S(o,e,r),T(n,e,null),l=!0},p(o,r){const c={};r&8198&&(c.$$scope={dirty:r,ctx:o}),!t&&r&1&&(t=!0,c.map=o[0],he(()=>t=!1)),n.$set(c)},i(o){l||(b(n.$$.fragment,o),l=!0)},o(o){w(n.$$.fragment,o),l=!1},d(o){o&&L(e),F(n)}}}function Pe(a){let e,n;return e=new ue({props:{$$slots:{main:[Ie],left:[Be]},$$scope:{ctx:a}}}),{c(){C(e.$$.fragment)},m(t,l){T(e,t,l),n=!0},p(t,[l]){const s={};l&8223&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Re(a){let e=a.properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function I(a){if(a=="lts")return null;if(a=="cost")return le(1,30);if(a=="nearby_amenities")return le(0,20)}function le(a,e){let n=[],t=(e-a)/5;for(let l=0;l<6;l++)n.push(a+l*t);return n}function ze(a,e,n){fe(async()=>{await Ce(),await be()});let t,l,s={type:"FeatureCollection",features:[]},u="lts",o=[0,0,0,0,0],r;async function c(f){try{let v=await r.files[0].arrayBuffer();l=new Te(new Uint8Array(v));let M=l.getBounds();t.fitBounds([[M[0],M[1]],[M[2],M[3]]],{padding:20,animate:!1}),n(1,s=JSON.parse(l.debugNetwork()));let _=0,d=[0,0,0,0,0];for(let h of s.features)h.properties.length&&(_+=h.properties.length,d[h.properties.lts]+=h.properties.length);n(3,o=d.map(h=>h/_*100)),console.log({allSum:_,ltsSum:d,percentByLength:o})}catch(v){window.alert(`Problem loading network file: ${v}`)}}function i(f){if(f=="lts")return we;if(f=="cost")return Y(["/",["get","cost"],["get","length"]],I(f),W);if(f=="nearby_amenities")return Y(["get","nearby_amenities"],I(f),W)}const k=f=>Re(f.detail.features[0]);function E(f){t=f,n(0,t)}function $(f){ie[f?"unshift":"push"](()=>{r=f,n(4,r)})}function j(){u=ke(this),n(2,u)}return[t,s,u,o,r,c,i,k,E,$,j]}class Ge extends se{constructor(e){super(),ae(this,e,ze,Pe,re,{})}}new Ge({target:document.getElementById("app")});
