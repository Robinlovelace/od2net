import{S as me,i as de,s as ge,ab as Z,e as $,f as B,z as M,l as y,E as se,v,ac as oe,g as z,n as b,a6 as he,L as we,c as O,a as q,t as C,b as S,d as E,o as ke,H as ye,x as V,y as te,h as K,q as x,A as ne,r as $e,u as be,M as ve,_ as Ce,$ as Se,a3 as T,ad as ie,C as Fe,j as Y,k as Le,p as ae,w as Ne,ae as ee,a0 as je,a9 as Be,aa as I,a2 as Me,a4 as Oe,a5 as qe}from"./Legend-4a68f35f.js";import{C as Ee,_ as Je,J as Te,a as Ae,G as He}from"./CostFunction-20018123.js";function re(s,t,n){const e=s.slice();return e[2]=t[n],e}function fe(s,t,n){const e=s.slice();return e[5]=t[n],e}function pe(s){let t,n;return{c(){t=$("span"),n=z(`Â 
    `),M(t,"background",s[5]),M(t,"width","100%"),M(t,"border","1px solid black")},m(e,l){y(e,t,l),b(t,n)},p(e,l){l&1&&M(t,"background",e[5])},d(e){e&&v(t)}}}function ue(s){let t,n=s[2].toFixed(1)+"",e;return{c(){t=$("span"),e=z(n)},m(l,o){y(l,t,o),b(t,e)},p(l,o){o&2&&n!==(n=l[2].toFixed(1)+"")&&he(e,n)},d(l){l&&v(t)}}}function Pe(s){let t,n,e,l=Z(s[0]),o=[];for(let i=0;i<l.length;i+=1)o[i]=pe(fe(s,l,i));let f=Z(s[1]),r=[];for(let i=0;i<f.length;i+=1)r[i]=ue(re(s,f,i));return{c(){t=$("div");for(let i=0;i<o.length;i+=1)o[i].c();n=B(),e=$("div");for(let i=0;i<r.length;i+=1)r[i].c();M(t,"display","flex"),M(e,"display","flex"),M(e,"justify-content","space-between")},m(i,_){y(i,t,_);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(t,null);y(i,n,_),y(i,e,_);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(i,[_]){if(_&1){l=Z(i[0]);let a;for(a=0;a<l.length;a+=1){const m=fe(i,l,a);o[a]?o[a].p(m,_):(o[a]=pe(m),o[a].c(),o[a].m(t,null))}for(;a<o.length;a+=1)o[a].d(1);o.length=l.length}if(_&2){f=Z(i[1]);let a;for(a=0;a<f.length;a+=1){const m=re(i,f,a);r[a]?r[a].p(m,_):(r[a]=ue(m),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=f.length}},i:se,o:se,d(i){i&&(v(t),v(n),v(e)),oe(o,i),oe(r,i)}}}function Ge(s,t,n){let{colorScale:e}=t,{limits:l}=t;return s.$$set=o=>{"colorScale"in o&&n(0,e=o.colorScale),"limits"in o&&n(1,l=o.limits)},[e,l]}class Ie extends me{constructor(t){super(),de(this,t,Ge,Pe,ge,{colorScale:0,limits:1})}}function ce(s){let t,n,e,l,o,f,r,i,_,a,m,d,F,A,L,N,P,R,G,g,c,j,H,D,U;const W=[ze,Re],J=[];function p(u,k){return u[5]=="lts"?0:1}m=p(s),d=J[m]=W[m](s);function w(u){s[20](u)}let h={};return s[1]!==void 0&&(h.cost=s[1]),c=new Ae({props:h}),V.push(()=>te(c,"cost",w)),{c(){t=$("hr"),n=B(),e=$("div"),l=$("label"),o=z(`Color edges by:
          `),f=$("select"),r=$("option"),r.textContent="LTS",i=$("option"),i.textContent="Edge cost (relative to length)",_=$("option"),_.textContent="Nearby amenities",a=B(),d.c(),F=B(),A=$("div"),L=$("label"),N=$("input"),P=z(`
          Show cyclists not allowed`),R=B(),G=$("hr"),g=B(),O(c.$$.fragment),r.__value="lts",Y(r,r.__value),i.__value="cost",Y(i,i.__value),_.__value="nearby_amenities",Y(_,_.__value),s[5]===void 0&&Le(()=>s[18].call(f)),K(N,"type","checkbox"),M(L,"color",T.lts_not_allowed)},m(u,k){y(u,t,k),y(u,n,k),y(u,e,k),b(e,l),b(l,o),b(l,f),b(f,r),b(f,i),b(f,_),ae(f,s[5],!0),y(u,a,k),J[m].m(u,k),y(u,F,k),y(u,A,k),b(A,L),b(L,N),N.checked=s[6],b(L,P),y(u,R,k),y(u,G,k),y(u,g,k),q(c,u,k),H=!0,D||(U=[x(f,"change",s[18]),x(N,"change",s[19])],D=!0)},p(u,k){k&32&&ae(f,u[5]);let X=m;m=p(u),m===X?J[m].p(u,k):($e(),S(J[X],1,1,()=>{J[X]=null}),be(),d=J[m],d?d.p(u,k):(d=J[m]=W[m](u),d.c()),C(d,1),d.m(F.parentNode,F)),k&64&&(N.checked=u[6]);const le={};!j&&k&2&&(j=!0,le.cost=u[1],ne(()=>j=!1)),c.$set(le)},i(u){H||(C(d),C(c.$$.fragment,u),H=!0)},o(u){S(d),S(c.$$.fragment,u),H=!1},d(u){u&&(v(t),v(n),v(e),v(a),v(F),v(A),v(R),v(G),v(g)),J[m].d(u),E(c,u),D=!1,Ne(U)}}}function Re(s){let t,n;return t=new Ie({props:{colorScale:ee,limits:Q(s[5],s[8],s[9])}}),{c(){O(t.$$.fragment)},m(e,l){q(t,e,l),n=!0},p(e,l){const o={};l&800&&(o.limits=Q(e[5],e[8],e[9])),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function ze(s){let t,n,e,l;return t=new Be({props:{rows:[[`${I.lts1}: ${s[7][1].toFixed(0)}% of roads by distance`,T.lts1],[`${I.lts2}: ${s[7][2].toFixed(0)}%`,T.lts2],[`${I.lts3}: ${s[7][3].toFixed(0)}%`,T.lts3],[`${I.lts4}: ${s[7][4].toFixed(0)}%`,T.lts4]]}}),{c(){O(t.$$.fragment),n=B(),e=$("p"),e.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(o,f){q(t,o,f),y(o,n,f),y(o,e,f),l=!0},p(o,f){const r={};f&128&&(r.rows=[[`${I.lts1}: ${o[7][1].toFixed(0)}% of roads by distance`,T.lts1],[`${I.lts2}: ${o[7][2].toFixed(0)}%`,T.lts2],[`${I.lts3}: ${o[7][3].toFixed(0)}%`,T.lts3],[`${I.lts4}: ${o[7][4].toFixed(0)}%`,T.lts4]]),t.$set(r)},i(o){l||(C(t.$$.fragment,o),l=!0)},o(o){S(t.$$.fragment,o),l=!1},d(o){o&&(v(n),v(e)),E(t,o)}}}function De(s){let t,n,e,l,o,f,r,i,_,a,m,d,F,A,L,N,P;n=new ye({props:{app:"costs"}});function R(c){s[17](c)}let G={};s[0]!==void 0&&(G.example=s[0]),d=new Ee({props:G}),V.push(()=>te(d,"example",R));let g=s[3]&&ce(s);return{c(){t=$("div"),O(n.$$.fragment),e=B(),l=$("label"),o=z("Open a "),f=$("i"),f.textContent=".bin",r=z(" network file or an "),i=$("i"),i.textContent=".osm.pbf",_=B(),a=$("input"),m=B(),O(d.$$.fragment),A=B(),g&&g.c(),K(a,"type","file"),K(t,"slot","left")},m(c,j){y(c,t,j),q(n,t,null),b(t,e),b(t,l),b(l,o),b(l,f),b(l,r),b(l,i),b(l,_),b(l,a),s[16](a),b(t,m),q(d,t,null),b(t,A),g&&g.m(t,null),L=!0,N||(P=x(a,"change",s[11]),N=!0)},p(c,j){const H={};!F&&j&1&&(F=!0,H.example=c[0],ne(()=>F=!1)),d.$set(H),c[3]?g?(g.p(c,j),j&8&&C(g,1)):(g=ce(c),g.c(),C(g,1),g.m(t,null)):g&&($e(),S(g,1,1,()=>{g=null}),be())},i(c){L||(C(n.$$.fragment,c),C(d.$$.fragment,c),C(g),L=!0)},o(c){S(n.$$.fragment,c),S(d.$$.fragment,c),S(g),L=!1},d(c){c&&v(t),E(n),s[16](null),E(d),g&&g.d(),N=!1,P()}}}function Ue(s){let t,n;return t=new qe({props:{properties:s[25][0].properties}}),{c(){O(t.$$.fragment)},m(e,l){q(t,e,l),n=!0},p(e,l){const o={};l&33554432&&(o.properties=e[25][0].properties),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function We(s){let t,n;return t=new Oe({props:{openOn:"hover",$$slots:{default:[Ue,({features:e})=>({25:e}),({features:e})=>e?33554432:0]},$$scope:{ctx:s}}}),{c(){O(t.$$.fragment)},m(e,l){q(t,e,l),n=!0},p(e,l){const o={};l&100663296&&(o.$$scope={dirty:l,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function Ze(s){let t,n;return t=new Me({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":s[12](s[5],s[8],s[9]),"line-opacity":s[13](s[5],s[6])},beforeId:"Road labels",$$slots:{default:[We]},$$scope:{ctx:s}}}),t.$on("click",s[14]),{c(){O(t.$$.fragment)},m(e,l){q(t,e,l),n=!0},p(e,l){const o={};l&864&&(o.paint={"line-width":5,"line-color":e[12](e[5],e[8],e[9]),"line-opacity":e[13](e[5],e[6])}),l&67108864&&(o.$$scope={dirty:l,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function Ke(s){let t,n;return t=new He({props:{data:s[4],$$slots:{default:[Ze]},$$scope:{ctx:s}}}),{c(){O(t.$$.fragment)},m(e,l){q(t,e,l),n=!0},p(e,l){const o={};l&16&&(o.data=e[4]),l&67109728&&(o.$$scope={dirty:l,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function Qe(s){let t,n,e,l;function o(r){s[15](r)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ke]},$$scope:{ctx:s}};return s[2]!==void 0&&(f.map=s[2]),n=new ve({props:f}),V.push(()=>te(n,"map",o)),{c(){t=$("div"),O(n.$$.fragment),K(t,"slot","main"),M(t,"position","relative"),M(t,"width","100%"),M(t,"height","100vh")},m(r,i){y(r,t,i),q(n,t,null),l=!0},p(r,i){const _={};i&67109744&&(_.$$scope={dirty:i,ctx:r}),!e&&i&4&&(e=!0,_.map=r[2],ne(()=>e=!1)),n.$set(_)},i(r){l||(C(n.$$.fragment,r),l=!0)},o(r){S(n.$$.fragment,r),l=!1},d(r){r&&v(t),E(n)}}}function Ve(s){let t,n;return t=new we({props:{$$slots:{main:[Qe],left:[De]},$$scope:{ctx:s}}}),{c(){O(t.$$.fragment)},m(e,l){q(t,e,l),n=!0},p(e,[l]){const o={};l&67110911&&(o.$$scope={dirty:l,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function Xe(s){let t=s.properties.way;window.open(`http://openstreetmap.org/way/${t}`,"_blank")}function Q(s,t,n){if(s=="lts")return null;if(s=="cost")return _e(0,t);if(s=="nearby_amenities")return _e(0,n)}function _e(s,t){let n=[],e=(t-s)/5;for(let l=0;l<6;l++)n.push(s+l*e);return n}function Ye(s,t,n){ke(async()=>{await Je(),await Ce()});let e,l,o="",f={type:"FeatureCollection",features:[]},r="Distance",i="cost",_=!1,a=[0,0,0,0,0],m=1,d=1,F;async function A(p){n(0,o=""),L(await F.files[0].arrayBuffer())}function L(p){try{n(3,l=new Te(new Uint8Array(p)));let w=l.getBounds();e.fitBounds([[w[0],w[1]],[w[2],w[3]]],{padding:20,animate:!1}),P()}catch(w){window.alert(`Problem loading network file: ${w}`)}}async function N(p){if(p!=""){let w=await fetch(`https://assets.od2net.org/pbf_clips/${p}.osm.pbf`);L(await w.arrayBuffer())}}function P(){n(4,f=JSON.parse(l.debugNetwork()));let p=0,w=[0,0,0,0,0];n(8,m=0),n(9,d=0);for(let h of f.features)n(9,d=Math.max(d,h.properties.nearby_amenities)),h.properties.length&&(n(8,m=Math.max(m,h.properties.cost/h.properties.length)),p+=h.properties.length,w[h.properties.lts]+=h.properties.length);n(7,a=w.map(h=>h/p*100))}function R(p,w,h){if(p=="lts")return Se;if(p=="cost")return["case",["==",0,["get","lts"]],T.lts_not_allowed,ie(["/",["get","cost"],["get","length"]],Q(p,w,h),ee)];if(p=="nearby_amenities")return ie(["get","nearby_amenities"],Q(p,w,h),ee)}function G(p,w){let h=je(1,.5);return p=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,h]:w?h:["case",["==",0,["get","lts"]],0,h]}function g(p){l&&(l.updateCostFunction(p),P())}const c=p=>Xe(p.detail.features[0]);function j(p){e=p,n(2,e)}function H(p){V[p?"unshift":"push"](()=>{F=p,n(10,F)})}function D(p){o=p,n(0,o)}function U(){i=Fe(this),n(5,i)}function W(){_=this.checked,n(6,_)}function J(p){r=p,n(1,r)}return s.$$.update=()=>{s.$$.dirty&1&&N(o),s.$$.dirty&2&&g(r)},[o,r,e,l,f,i,_,a,m,d,F,A,R,G,c,j,H,D,U,W,J]}class xe extends me{constructor(t){super(),de(this,t,Ye,Ve,ge,{})}}new xe({target:document.getElementById("app")});
