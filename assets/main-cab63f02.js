import{S as ee,i as te,s as J,m as ie,P as re,L as se,c as Z,a as E,t as d,b,d as O,o as ue,H as fe,e as g,f as N,g as F,h as H,j as S,k as pe,l as C,n as c,p as K,q as W,r as I,u as R,v as P,w as me,M as ce,x as T,y as oe,z as B,A as ae,_ as de,B as Y,F as _e,C as ge,D as ne,E as le}from"./Legend-2db49f7e.js";import{S as be,L as he}from"./SidebarControls-1356fd97.js";let D="pmtilesSource";async function ve(n){let e=await n.getHeader(),a=await n.getMetadata();return{bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],outputMetadata:JSON.parse(a.description),minZoom:e.minZoom,maxZoom:e.maxZoom}}function ye(n,e,a){let{pmtiles:t}=e,{map:o}=e,{outputMetadata:l=null}=e,s=new re;ie.addProtocol("pmtiles",s.tile);async function _(i){r(D),s.add(i);let f=await ve(i);o.addSource(D,{type:"vector",tiles:["pmtiles://"+i.source.getKey()+"/{z}/{x}/{y}"],minzoom:f.minZoom,maxzoom:f.maxZoom,bounds:f.bounds}),o.fitBounds(f.bounds,{padding:100,duration:500}),a(0,l=f.outputMetadata)}function r(i){if(o.getSource(i)){let f=[];for(let u of o.getStyle().layers)"source"in u&&u.source==i&&f.push(u.id);for(let u of f)o.removeLayer(u);o.removeSource(i)}}return n.$$set=i=>{"pmtiles"in i&&a(1,t=i.pmtiles),"map"in i&&a(2,o=i.map),"outputMetadata"in i&&a(0,l=i.outputMetadata)},n.$$.update=()=>{n.$$.dirty&2&&(t?_(t):r(D))},[l,t,o]}class ke extends ee{constructor(e){super(),te(this,e,ye,null,J,{pmtiles:1,map:2,outputMetadata:0})}}function Q(n){let e,a,t;return{c(){e=F("Open a "),a=g("i"),a.textContent=".pmtiles",t=F(` file produced by the tool. Note this file stays in
        your browser; it doesn't get uploaded anywhere.`)},m(o,l){C(o,e,l),C(o,a,l),C(o,t,l)},d(o){o&&(P(e),P(a),P(t))}}}function U(n){let e,a;return e=new be({props:{outputMetadata:n[3],map:n[0],controls:n[5]}}),{c(){Z(e.$$.fragment)},m(t,o){E(e,t,o),a=!0},p(t,o){const l={};o&8&&(l.outputMetadata=t[3]),o&1&&(l.map=t[0]),e.$set(l)},i(t){a||(d(e.$$.fragment,t),a=!0)},o(t){b(e.$$.fragment,t),a=!1},d(t){O(e,t)}}}function $e(n){let e,a,t,o,l,s,_,r,i,f,u,k,$,p,y,w,M,L,j,q,A,G;a=new fe({props:{app:"main"}});let h=n[2]==null&&Q(),m=n[3]&&U(n);return{c(){e=g("div"),Z(a.$$.fragment),t=N(),o=g("label"),h&&h.c(),l=N(),s=g("input"),_=N(),r=g("div"),i=g("label"),f=F(`Or load an example:
        `),u=g("select"),k=g("option"),k.textContent="Custom file loaded",$=g("option"),$.textContent="Edinburgh",p=g("option"),p.textContent="England (2011 home-to-work)",y=g("option"),y.textContent="Liverpool",w=g("option"),w.textContent="London",M=g("option"),M.textContent="Seattle",L=g("option"),L.textContent="York",j=N(),m&&m.c(),H(s,"type","file"),k.__value="",S(k,k.__value),$.__value="edinburgh",S($,$.__value),p.__value="england_2011_home_to_work",S(p,p.__value),y.__value="liverpool",S(y,y.__value),w.__value="london",S(w,w.__value),M.__value="seattle",S(M,M.__value),L.__value="york",S(L,L.__value),n[1]===void 0&&pe(()=>n[10].call(u)),H(e,"slot","left")},m(v,z){C(v,e,z),E(a,e,null),c(e,t),c(e,o),h&&h.m(o,null),c(o,l),c(o,s),n[9](s),c(e,_),c(e,r),c(r,i),c(i,f),c(i,u),c(u,k),c(u,$),c(u,p),c(u,y),c(u,w),c(u,M),c(u,L),K(u,n[1],!0),c(e,j),m&&m.m(e,null),q=!0,A||(G=[W(s,"change",n[6]),W(u,"change",n[10])],A=!0)},p(v,z){v[2]==null?h||(h=Q(),h.c(),h.m(o,l)):h&&(h.d(1),h=null),z&2&&K(u,v[1]),v[3]?m?(m.p(v,z),z&8&&d(m,1)):(m=U(v),m.c(),d(m,1),m.m(e,null)):m&&(I(),b(m,1,1,()=>{m=null}),R())},i(v){q||(d(a.$$.fragment,v),d(m),q=!0)},o(v){b(a.$$.fragment,v),b(m),q=!1},d(v){v&&P(e),O(a),h&&h.d(),n[9](null),m&&m.d(),A=!1,me(G)}}}function V(n){let e=n[3],a,t,o=X(n);return{c(){o.c(),a=ne()},m(l,s){o.m(l,s),C(l,a,s),t=!0},p(l,s){s&8&&J(e,e=l[3])?(I(),b(o,1,1,le),R(),o=X(l),o.c(),d(o,1),o.m(a.parentNode,a)):o.p(l,s)},i(l){t||(d(o),t=!0)},o(l){b(o),t=!1},d(l){l&&P(a),o.d(l)}}}function X(n){let e,a;return e=new he({props:{sourceOverride:{source:"pmtilesSource",sourceLayer:"rnet"},controls:n[5]}}),{c(){Z(e.$$.fragment)},m(t,o){E(e,t,o),a=!0},p:le,i(t){a||(d(e.$$.fragment,t),a=!0)},o(t){b(e.$$.fragment,t),a=!1},d(t){O(e,t)}}}function we(n){let e,a,t=n[3]&&V(n);return{c(){t&&t.c(),e=ne()},m(o,l){t&&t.m(o,l),C(o,e,l),a=!0},p(o,l){o[3]?t?(t.p(o,l),l&8&&d(t,1)):(t=V(o),t.c(),d(t,1),t.m(e.parentNode,e)):t&&(I(),b(t,1,1,()=>{t=null}),R())},i(o){a||(d(t),a=!0)},o(o){b(t),a=!1},d(o){o&&P(e),t&&t.d(o)}}}function x(n){let e,a,t;function o(s){n[8](s)}let l={map:n[0],pmtiles:n[2]};return n[3]!==void 0&&(l.outputMetadata=n[3]),e=new ke({props:l}),T.push(()=>oe(e,"outputMetadata",o)),{c(){Z(e.$$.fragment)},m(s,_){E(e,s,_),t=!0},p(s,_){const r={};_&1&&(r.map=s[0]),_&4&&(r.pmtiles=s[2]),!a&&_&8&&(a=!0,r.outputMetadata=s[3],ae(()=>a=!1)),e.$set(r)},i(s){t||(d(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){O(e,s)}}}function Me(n){let e,a,t,o,l;function s(i){n[7](i)}let _={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[we]},$$scope:{ctx:n}};n[0]!==void 0&&(_.map=n[0]),a=new ce({props:_}),T.push(()=>oe(a,"map",s));let r=n[0]&&x(n);return{c(){e=g("div"),Z(a.$$.fragment),o=N(),r&&r.c(),H(e,"slot","main"),B(e,"position","relative"),B(e,"width","100%"),B(e,"height","100vh")},m(i,f){C(i,e,f),E(a,e,null),c(e,o),r&&r.m(e,null),l=!0},p(i,f){const u={};f&2056&&(u.$$scope={dirty:f,ctx:i}),!t&&f&1&&(t=!0,u.map=i[0],ae(()=>t=!1)),a.$set(u),i[0]?r?(r.p(i,f),f&1&&d(r,1)):(r=x(i),r.c(),d(r,1),r.m(e,null)):r&&(I(),b(r,1,1,()=>{r=null}),R())},i(i){l||(d(a.$$.fragment,i),d(r),l=!0)},o(i){b(a.$$.fragment,i),b(r),l=!1},d(i){i&&P(e),O(a),r&&r.d()}}}function Le(n){let e,a;return e=new se({props:{$$slots:{main:[Me],left:[$e]},$$scope:{ctx:n}}}),{c(){Z(e.$$.fragment)},m(t,o){E(e,t,o),a=!0},p(t,[o]){const l={};o&2079&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){a||(d(e.$$.fragment,t),a=!0)},o(t){b(e.$$.fragment,t),a=!1},d(t){O(e,t)}}}function Se(n,e,a){ue(async()=>{await de()});let t,o,l="",s,_={maxCount:1e3,originRadius:3,destinationRadius:3,streetviewOn:!1},r;function i(p){try{a(1,l="");let y=r.files;a(2,o=new Y(new _e(y[0])))}catch(y){window.alert(`Problem loading this PMTiles file. Don't open the GeoJSON file; make sure to select .pmtiles. Error: ${y}`)}}function f(p){t=p,a(0,t)}function u(p){s=p,a(3,s)}function k(p){T[p?"unshift":"push"](()=>{r=p,a(4,r)})}function $(){l=ge(this),a(1,l)}return n.$$.update=()=>{n.$$.dirty&2&&l!=""&&a(2,o=new Y(`https://assets.od2net.org/output/${l}.pmtiles`)),n.$$.dirty&1&&t&&t.on("moveend",()=>{let p=[];for(let L of t.queryRenderedFeatures(void 0,{layers:["input-layer"]}))p.push(L.properties.count);let y=Math.min(...p),w=Math.max(...p),M=p.length;console.log({min:y,max:w,count:M})})},[t,l,o,s,r,_,i,f,u,k,$]}class Ce extends ee{constructor(e){super(),te(this,e,Se,Le,J,{})}}new Ce({target:document.getElementById("app")});
