import{S as me,i as de,s as ge,ab as Z,e as g,f as q,z as E,l as h,E as se,v as w,ac as oe,g as G,n as k,a6 as he,L as we,c as N,a as j,t as v,b as C,d as B,o as ke,H as ye,x as V,y as te,h as K,q as x,A as ne,r as $e,u as be,M as ve,_ as Ce,$ as Se,a3 as A,ad as ie,C as Fe,j as Y,k as Le,p as ae,w as Ne,ae as ee,a0 as je,a9 as Be,aa as H,a2 as Me,a4 as Oe,a5 as qe}from"./Legend-36db5a45.js";import{L as Ee,C as Je,_ as Te,J as Ae,a as He,G as Pe}from"./Loading-ad1d8aa1.js";function re(s,t,n){const e=s.slice();return e[2]=t[n],e}function fe(s,t,n){const e=s.slice();return e[5]=t[n],e}function pe(s){let t,n;return{c(){t=g("span"),n=G(`Â 
    `),E(t,"background",s[5]),E(t,"width","100%"),E(t,"border","1px solid black")},m(e,o){h(e,t,o),k(t,n)},p(e,o){o&1&&E(t,"background",e[5])},d(e){e&&w(t)}}}function ue(s){let t,n=s[2].toFixed(1)+"",e;return{c(){t=g("span"),e=G(n)},m(o,l){h(o,t,l),k(t,e)},p(o,l){l&2&&n!==(n=o[2].toFixed(1)+"")&&he(e,n)},d(o){o&&w(t)}}}function De(s){let t,n,e,o=Z(s[0]),l=[];for(let i=0;i<o.length;i+=1)l[i]=pe(fe(s,o,i));let p=Z(s[1]),r=[];for(let i=0;i<p.length;i+=1)r[i]=ue(re(s,p,i));return{c(){t=g("div");for(let i=0;i<l.length;i+=1)l[i].c();n=q(),e=g("div");for(let i=0;i<r.length;i+=1)r[i].c();E(t,"display","flex"),E(e,"display","flex"),E(e,"justify-content","space-between")},m(i,c){h(i,t,c);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null);h(i,n,c),h(i,e,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(i,[c]){if(c&1){o=Z(i[0]);let a;for(a=0;a<o.length;a+=1){const _=fe(i,o,a);l[a]?l[a].p(_,c):(l[a]=pe(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=o.length}if(c&2){p=Z(i[1]);let a;for(a=0;a<p.length;a+=1){const _=re(i,p,a);r[a]?r[a].p(_,c):(r[a]=ue(_),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=p.length}},i:se,o:se,d(i){i&&(w(t),w(n),w(e)),oe(l,i),oe(r,i)}}}function Ge(s,t,n){let{colorScale:e}=t,{limits:o}=t;return s.$$set=l=>{"colorScale"in l&&n(0,e=l.colorScale),"limits"in l&&n(1,o=l.limits)},[e,o]}class Ie extends me{constructor(t){super(),de(this,t,Ge,De,ge,{colorScale:0,limits:1})}}function ce(s){let t,n,e,o,l,p,r,i,c,a,_,$,S,F,J,M,P,m,d,O,L,I,D,R,z;const U=[ze,Re],T=[];function W(f,y){return f[5]=="lts"?0:1}_=W(s),$=T[_]=U[_](s);function u(f){s[21](f)}let b={};return s[1]!==void 0&&(b.cost=s[1]),L=new He({props:b}),V.push(()=>te(L,"cost",u)),{c(){t=g("hr"),n=q(),e=g("div"),o=g("label"),l=G(`Color edges by:
          `),p=g("select"),r=g("option"),r.textContent="LTS",i=g("option"),i.textContent="Edge cost (relative to length)",c=g("option"),c.textContent="Nearby amenities",a=q(),$.c(),S=q(),F=g("div"),J=g("label"),M=g("input"),P=G(`
          Show cyclists not allowed`),m=q(),d=g("hr"),O=q(),N(L.$$.fragment),r.__value="lts",Y(r,r.__value),i.__value="cost",Y(i,i.__value),c.__value="nearby_amenities",Y(c,c.__value),s[5]===void 0&&Le(()=>s[19].call(p)),K(M,"type","checkbox"),E(J,"color",A.lts_not_allowed)},m(f,y){h(f,t,y),h(f,n,y),h(f,e,y),k(e,o),k(o,l),k(o,p),k(p,r),k(p,i),k(p,c),ae(p,s[5],!0),h(f,a,y),T[_].m(f,y),h(f,S,y),h(f,F,y),k(F,J),k(J,M),M.checked=s[6],k(J,P),h(f,m,y),h(f,d,y),h(f,O,y),j(L,f,y),D=!0,R||(z=[x(p,"change",s[19]),x(M,"change",s[20])],R=!0)},p(f,y){y&32&&ae(p,f[5]);let X=_;_=W(f),_===X?T[_].p(f,y):($e(),C(T[X],1,1,()=>{T[X]=null}),be(),$=T[_],$?$.p(f,y):($=T[_]=U[_](f),$.c()),v($,1),$.m(S.parentNode,S)),y&64&&(M.checked=f[6]);const le={};!I&&y&2&&(I=!0,le.cost=f[1],ne(()=>I=!1)),L.$set(le)},i(f){D||(v($),v(L.$$.fragment,f),D=!0)},o(f){C($),C(L.$$.fragment,f),D=!1},d(f){f&&(w(t),w(n),w(e),w(a),w(S),w(F),w(m),w(d),w(O)),T[_].d(f),B(L,f),R=!1,Ne(z)}}}function Re(s){let t,n;return t=new Ie({props:{colorScale:ee,limits:Q(s[5],s[9],s[10])}}),{c(){N(t.$$.fragment)},m(e,o){j(t,e,o),n=!0},p(e,o){const l={};o&1568&&(l.limits=Q(e[5],e[9],e[10])),t.$set(l)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){C(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function ze(s){let t,n,e,o;return t=new Be({props:{rows:[[`${H.lts1}: ${s[8][1].toFixed(0)}% of roads by distance`,A.lts1],[`${H.lts2}: ${s[8][2].toFixed(0)}%`,A.lts2],[`${H.lts3}: ${s[8][3].toFixed(0)}%`,A.lts3],[`${H.lts4}: ${s[8][4].toFixed(0)}%`,A.lts4]]}}),{c(){N(t.$$.fragment),n=q(),e=g("p"),e.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(l,p){j(t,l,p),h(l,n,p),h(l,e,p),o=!0},p(l,p){const r={};p&256&&(r.rows=[[`${H.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,A.lts1],[`${H.lts2}: ${l[8][2].toFixed(0)}%`,A.lts2],[`${H.lts3}: ${l[8][3].toFixed(0)}%`,A.lts3],[`${H.lts4}: ${l[8][4].toFixed(0)}%`,A.lts4]]),t.$set(r)},i(l){o||(v(t.$$.fragment,l),o=!0)},o(l){C(t.$$.fragment,l),o=!1},d(l){l&&(w(n),w(e)),B(t,l)}}}function Ue(s){let t,n,e,o,l,p,r,i,c,a,_,$,S,F,J;n=new ye({props:{app:"costs"}});function M(d){s[18](d)}let P={};s[0]!==void 0&&(P.example=s[0]),a=new Je({props:P}),V.push(()=>te(a,"example",M));let m=s[3]&&ce(s);return{c(){t=g("div"),N(n.$$.fragment),e=q(),o=g("label"),l=G("Open an "),p=g("i"),p.textContent=".osm.pbf",r=G(` file
      `),i=g("input"),c=q(),N(a.$$.fragment),$=q(),m&&m.c(),K(i,"type","file"),K(t,"slot","left")},m(d,O){h(d,t,O),j(n,t,null),k(t,e),k(t,o),k(o,l),k(o,p),k(o,r),k(o,i),s[17](i),k(t,c),j(a,t,null),k(t,$),m&&m.m(t,null),S=!0,F||(J=x(i,"change",s[12]),F=!0)},p(d,O){const L={};!_&&O&1&&(_=!0,L.example=d[0],ne(()=>_=!1)),a.$set(L),d[3]?m?(m.p(d,O),O&8&&v(m,1)):(m=ce(d),m.c(),v(m,1),m.m(t,null)):m&&($e(),C(m,1,1,()=>{m=null}),be())},i(d){S||(v(n.$$.fragment,d),v(a.$$.fragment,d),v(m),S=!0)},o(d){C(n.$$.fragment,d),C(a.$$.fragment,d),C(m),S=!1},d(d){d&&w(t),B(n),s[17](null),B(a),m&&m.d(),F=!1,J()}}}function We(s){let t,n;return t=new qe({props:{properties:s[26][0].properties}}),{c(){N(t.$$.fragment)},m(e,o){j(t,e,o),n=!0},p(e,o){const l={};o&67108864&&(l.properties=e[26][0].properties),t.$set(l)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){C(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function Ze(s){let t,n;return t=new Oe({props:{openOn:"hover",$$slots:{default:[We,({features:e})=>({26:e}),({features:e})=>e?67108864:0]},$$scope:{ctx:s}}}),{c(){N(t.$$.fragment)},m(e,o){j(t,e,o),n=!0},p(e,o){const l={};o&201326592&&(l.$$scope={dirty:o,ctx:e}),t.$set(l)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){C(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function Ke(s){let t,n;return t=new Me({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":s[13](s[5],s[9],s[10]),"line-opacity":s[14](s[5],s[6])},beforeId:"Road labels",$$slots:{default:[Ze]},$$scope:{ctx:s}}}),t.$on("click",s[15]),{c(){N(t.$$.fragment)},m(e,o){j(t,e,o),n=!0},p(e,o){const l={};o&1632&&(l.paint={"line-width":5,"line-color":e[13](e[5],e[9],e[10]),"line-opacity":e[14](e[5],e[6])}),o&134217728&&(l.$$scope={dirty:o,ctx:e}),t.$set(l)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){C(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function Qe(s){let t,n;return t=new Pe({props:{data:s[4],$$slots:{default:[Ke]},$$scope:{ctx:s}}}),{c(){N(t.$$.fragment)},m(e,o){j(t,e,o),n=!0},p(e,o){const l={};o&16&&(l.data=e[4]),o&134219360&&(l.$$scope={dirty:o,ctx:e}),t.$set(l)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){C(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function Ve(s){let t,n,e,o;function l(r){s[16](r)}let p={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Qe]},$$scope:{ctx:s}};return s[2]!==void 0&&(p.map=s[2]),n=new ve({props:p}),V.push(()=>te(n,"map",l)),{c(){t=g("div"),N(n.$$.fragment),K(t,"slot","main"),E(t,"position","relative"),E(t,"width","100%"),E(t,"height","100vh")},m(r,i){h(r,t,i),j(n,t,null),o=!0},p(r,i){const c={};i&134219376&&(c.$$scope={dirty:i,ctx:r}),!e&&i&4&&(e=!0,c.map=r[2],ne(()=>e=!1)),n.$set(c)},i(r){o||(v(n.$$.fragment,r),o=!0)},o(r){C(n.$$.fragment,r),o=!1},d(r){r&&w(t),B(n)}}}function Xe(s){let t,n,e,o;return t=new we({props:{$$slots:{main:[Ve],left:[Ue]},$$scope:{ctx:s}}}),e=new Ee({props:{loading:s[7]}}),{c(){N(t.$$.fragment),n=q(),N(e.$$.fragment)},m(l,p){j(t,l,p),h(l,n,p),j(e,l,p),o=!0},p(l,[p]){const r={};p&134221695&&(r.$$scope={dirty:p,ctx:l}),t.$set(r);const i={};p&128&&(i.loading=l[7]),e.$set(i)},i(l){o||(v(t.$$.fragment,l),v(e.$$.fragment,l),o=!0)},o(l){C(t.$$.fragment,l),C(e.$$.fragment,l),o=!1},d(l){l&&w(n),B(t,l),B(e,l)}}}function Ye(s){let t=s.properties.way;window.open(`http://openstreetmap.org/way/${t}`,"_blank")}function Q(s,t,n){if(s=="lts")return null;if(s=="cost")return _e(0,t);if(s=="nearby_amenities")return _e(0,n)}function _e(s,t){let n=[],e=(t-s)/5;for(let o=0;o<6;o++)n.push(s+o*e);return n}function xe(s,t,n){ke(async()=>{await Te(),await Ce()});let e,o,l="",p={type:"FeatureCollection",features:[]},r="Distance",i="cost",c=!1,a=!1,_=[0,0,0,0,0],$=1,S=1,F;async function J(u){n(0,l=""),n(7,a=!0),M(await F.files[0].arrayBuffer())}function M(u){try{n(3,o=new Ae(new Uint8Array(u))),n(1,r="Distance");let b=o.getBounds();e.fitBounds([[b[0],b[1]],[b[2],b[3]]],{padding:20,animate:!1}),m()}catch(b){window.alert(`Problem importing osm.pbf file: ${b}`)}n(7,a=!1)}async function P(u){if(u!=""){n(7,a=!0);let b=await fetch(`https://assets.od2net.org/pbf_clips/${u}.osm.pbf`);M(await b.arrayBuffer())}}function m(){n(4,p=JSON.parse(o.debugNetwork()));let u=0,b=[0,0,0,0,0];n(9,$=0),n(10,S=0);for(let f of p.features)n(10,S=Math.max(S,f.properties.nearby_amenities)),f.properties.length&&(n(9,$=Math.max($,f.properties.cost/f.properties.length)),u+=f.properties.length,b[f.properties.lts]+=f.properties.length);n(8,_=b.map(f=>f/u*100))}function d(u,b,f){if(u=="lts")return Se;if(u=="cost")return["case",["==",0,["get","lts"]],A.lts_not_allowed,ie(["/",["get","cost"],["get","length"]],Q(u,b,f),ee)];if(u=="nearby_amenities")return ie(["get","nearby_amenities"],Q(u,b,f),ee)}function O(u,b){let f=je(1,.5);return u=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,f]:b?f:["case",["==",0,["get","lts"]],0,f]}function L(u){o&&(o.updateCostFunction(u),m())}const I=u=>Ye(u.detail.features[0]);function D(u){e=u,n(2,e)}function R(u){V[u?"unshift":"push"](()=>{F=u,n(11,F)})}function z(u){l=u,n(0,l)}function U(){i=Fe(this),n(5,i)}function T(){c=this.checked,n(6,c)}function W(u){r=u,n(1,r)}return s.$$.update=()=>{s.$$.dirty&1&&P(l),s.$$.dirty&2&&L(r)},[l,r,e,o,p,i,c,a,_,$,S,F,J,d,O,I,D,R,z,U,T,W]}class et extends me{constructor(t){super(),de(this,t,xe,Xe,ge,{})}}new et({target:document.getElementById("app")});
