import{S as me,i as de,s as ge,ab as Z,e as g,f as H,z as B,l as y,E as se,v,ac as oe,g as I,n as h,a6 as he,L as we,c as M,a as O,t as C,b as F,d as q,o as ke,H as ye,x as V,y as te,h as K,q as x,A as ne,r as $e,u as be,M as ve,_ as Ce,$ as Se,a3 as A,ad as ie,C as Fe,j as Y,k as Le,p as ae,w as Ne,ae as ee,a0 as je,a9 as Be,aa as D,a2 as Me,a4 as Oe,a5 as qe}from"./Legend-4a68f35f.js";import{C as Ee,_ as Je,J as Te,a as Ae,G as He}from"./CostFunction-20018123.js";function re(l,t,n){const e=l.slice();return e[2]=t[n],e}function fe(l,t,n){const e=l.slice();return e[5]=t[n],e}function pe(l){let t,n;return{c(){t=g("span"),n=I(`Â 
    `),B(t,"background",l[5]),B(t,"width","100%"),B(t,"border","1px solid black")},m(e,s){y(e,t,s),h(t,n)},p(e,s){s&1&&B(t,"background",e[5])},d(e){e&&v(t)}}}function ue(l){let t,n=l[2].toFixed(1)+"",e;return{c(){t=g("span"),e=I(n)},m(s,o){y(s,t,o),h(t,e)},p(s,o){o&2&&n!==(n=s[2].toFixed(1)+"")&&he(e,n)},d(s){s&&v(t)}}}function Pe(l){let t,n,e,s=Z(l[0]),o=[];for(let i=0;i<s.length;i+=1)o[i]=pe(fe(l,s,i));let f=Z(l[1]),r=[];for(let i=0;i<f.length;i+=1)r[i]=ue(re(l,f,i));return{c(){t=g("div");for(let i=0;i<o.length;i+=1)o[i].c();n=H(),e=g("div");for(let i=0;i<r.length;i+=1)r[i].c();B(t,"display","flex"),B(e,"display","flex"),B(e,"justify-content","space-between")},m(i,_){y(i,t,_);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(t,null);y(i,n,_),y(i,e,_);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(i,[_]){if(_&1){s=Z(i[0]);let a;for(a=0;a<s.length;a+=1){const c=fe(i,s,a);o[a]?o[a].p(c,_):(o[a]=pe(c),o[a].c(),o[a].m(t,null))}for(;a<o.length;a+=1)o[a].d(1);o.length=s.length}if(_&2){f=Z(i[1]);let a;for(a=0;a<f.length;a+=1){const c=re(i,f,a);r[a]?r[a].p(c,_):(r[a]=ue(c),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=f.length}},i:se,o:se,d(i){i&&(v(t),v(n),v(e)),oe(o,i),oe(r,i)}}}function De(l,t,n){let{colorScale:e}=t,{limits:s}=t;return l.$$set=o=>{"colorScale"in o&&n(0,e=o.colorScale),"limits"in o&&n(1,s=o.limits)},[e,s]}class Ge extends me{constructor(t){super(),de(this,t,De,Pe,ge,{colorScale:0,limits:1})}}function ce(l){let t,n,e,s,o,f,r,i,_,a,c,$,S,E,N,J,P,m,d,j,L,R,G,z,U;const W=[Re,Ie],T=[];function p(u,k){return u[5]=="lts"?0:1}c=p(l),$=T[c]=W[c](l);function w(u){l[20](u)}let b={};return l[1]!==void 0&&(b.cost=l[1]),L=new Ae({props:b}),V.push(()=>te(L,"cost",w)),{c(){t=g("hr"),n=H(),e=g("div"),s=g("label"),o=I(`Color edges by:
          `),f=g("select"),r=g("option"),r.textContent="LTS",i=g("option"),i.textContent="Edge cost (relative to length)",_=g("option"),_.textContent="Nearby amenities",a=H(),$.c(),S=H(),E=g("div"),N=g("label"),J=g("input"),P=I(`
          Show cyclists not allowed`),m=H(),d=g("hr"),j=H(),M(L.$$.fragment),r.__value="lts",Y(r,r.__value),i.__value="cost",Y(i,i.__value),_.__value="nearby_amenities",Y(_,_.__value),l[5]===void 0&&Le(()=>l[18].call(f)),K(J,"type","checkbox"),B(N,"color",A.lts_not_allowed)},m(u,k){y(u,t,k),y(u,n,k),y(u,e,k),h(e,s),h(s,o),h(s,f),h(f,r),h(f,i),h(f,_),ae(f,l[5],!0),y(u,a,k),T[c].m(u,k),y(u,S,k),y(u,E,k),h(E,N),h(N,J),J.checked=l[6],h(N,P),y(u,m,k),y(u,d,k),y(u,j,k),O(L,u,k),G=!0,z||(U=[x(f,"change",l[18]),x(J,"change",l[19])],z=!0)},p(u,k){k&32&&ae(f,u[5]);let X=c;c=p(u),c===X?T[c].p(u,k):($e(),F(T[X],1,1,()=>{T[X]=null}),be(),$=T[c],$?$.p(u,k):($=T[c]=W[c](u),$.c()),C($,1),$.m(S.parentNode,S)),k&64&&(J.checked=u[6]);const le={};!R&&k&2&&(R=!0,le.cost=u[1],ne(()=>R=!1)),L.$set(le)},i(u){G||(C($),C(L.$$.fragment,u),G=!0)},o(u){F($),F(L.$$.fragment,u),G=!1},d(u){u&&(v(t),v(n),v(e),v(a),v(S),v(E),v(m),v(d),v(j)),T[c].d(u),q(L,u),z=!1,Ne(U)}}}function Ie(l){let t,n;return t=new Ge({props:{colorScale:ee,limits:Q(l[5],l[8],l[9])}}),{c(){M(t.$$.fragment)},m(e,s){O(t,e,s),n=!0},p(e,s){const o={};s&800&&(o.limits=Q(e[5],e[8],e[9])),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){F(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function Re(l){let t,n,e,s;return t=new Be({props:{rows:[[`${D.lts1}: ${l[7][1].toFixed(0)}% of roads by distance`,A.lts1],[`${D.lts2}: ${l[7][2].toFixed(0)}%`,A.lts2],[`${D.lts3}: ${l[7][3].toFixed(0)}%`,A.lts3],[`${D.lts4}: ${l[7][4].toFixed(0)}%`,A.lts4]]}}),{c(){M(t.$$.fragment),n=H(),e=g("p"),e.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(o,f){O(t,o,f),y(o,n,f),y(o,e,f),s=!0},p(o,f){const r={};f&128&&(r.rows=[[`${D.lts1}: ${o[7][1].toFixed(0)}% of roads by distance`,A.lts1],[`${D.lts2}: ${o[7][2].toFixed(0)}%`,A.lts2],[`${D.lts3}: ${o[7][3].toFixed(0)}%`,A.lts3],[`${D.lts4}: ${o[7][4].toFixed(0)}%`,A.lts4]]),t.$set(r)},i(o){s||(C(t.$$.fragment,o),s=!0)},o(o){F(t.$$.fragment,o),s=!1},d(o){o&&(v(n),v(e)),q(t,o)}}}function ze(l){let t,n,e,s,o,f,r,i,_,a,c,$,S,E,N;n=new ye({props:{app:"costs"}});function J(d){l[17](d)}let P={};l[0]!==void 0&&(P.example=l[0]),a=new Ee({props:P}),V.push(()=>te(a,"example",J));let m=l[3]&&ce(l);return{c(){t=g("div"),M(n.$$.fragment),e=H(),s=g("label"),o=I("Open an "),f=g("i"),f.textContent=".osm.pbf",r=I(` file
      `),i=g("input"),_=H(),M(a.$$.fragment),$=H(),m&&m.c(),K(i,"type","file"),K(t,"slot","left")},m(d,j){y(d,t,j),O(n,t,null),h(t,e),h(t,s),h(s,o),h(s,f),h(s,r),h(s,i),l[16](i),h(t,_),O(a,t,null),h(t,$),m&&m.m(t,null),S=!0,E||(N=x(i,"change",l[11]),E=!0)},p(d,j){const L={};!c&&j&1&&(c=!0,L.example=d[0],ne(()=>c=!1)),a.$set(L),d[3]?m?(m.p(d,j),j&8&&C(m,1)):(m=ce(d),m.c(),C(m,1),m.m(t,null)):m&&($e(),F(m,1,1,()=>{m=null}),be())},i(d){S||(C(n.$$.fragment,d),C(a.$$.fragment,d),C(m),S=!0)},o(d){F(n.$$.fragment,d),F(a.$$.fragment,d),F(m),S=!1},d(d){d&&v(t),q(n),l[16](null),q(a),m&&m.d(),E=!1,N()}}}function Ue(l){let t,n;return t=new qe({props:{properties:l[25][0].properties}}),{c(){M(t.$$.fragment)},m(e,s){O(t,e,s),n=!0},p(e,s){const o={};s&33554432&&(o.properties=e[25][0].properties),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){F(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function We(l){let t,n;return t=new Oe({props:{openOn:"hover",$$slots:{default:[Ue,({features:e})=>({25:e}),({features:e})=>e?33554432:0]},$$scope:{ctx:l}}}),{c(){M(t.$$.fragment)},m(e,s){O(t,e,s),n=!0},p(e,s){const o={};s&100663296&&(o.$$scope={dirty:s,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){F(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function Ze(l){let t,n;return t=new Me({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":l[12](l[5],l[8],l[9]),"line-opacity":l[13](l[5],l[6])},beforeId:"Road labels",$$slots:{default:[We]},$$scope:{ctx:l}}}),t.$on("click",l[14]),{c(){M(t.$$.fragment)},m(e,s){O(t,e,s),n=!0},p(e,s){const o={};s&864&&(o.paint={"line-width":5,"line-color":e[12](e[5],e[8],e[9]),"line-opacity":e[13](e[5],e[6])}),s&67108864&&(o.$$scope={dirty:s,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){F(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function Ke(l){let t,n;return t=new He({props:{data:l[4],$$slots:{default:[Ze]},$$scope:{ctx:l}}}),{c(){M(t.$$.fragment)},m(e,s){O(t,e,s),n=!0},p(e,s){const o={};s&16&&(o.data=e[4]),s&67109728&&(o.$$scope={dirty:s,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){F(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function Qe(l){let t,n,e,s;function o(r){l[15](r)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ke]},$$scope:{ctx:l}};return l[2]!==void 0&&(f.map=l[2]),n=new ve({props:f}),V.push(()=>te(n,"map",o)),{c(){t=g("div"),M(n.$$.fragment),K(t,"slot","main"),B(t,"position","relative"),B(t,"width","100%"),B(t,"height","100vh")},m(r,i){y(r,t,i),O(n,t,null),s=!0},p(r,i){const _={};i&67109744&&(_.$$scope={dirty:i,ctx:r}),!e&&i&4&&(e=!0,_.map=r[2],ne(()=>e=!1)),n.$set(_)},i(r){s||(C(n.$$.fragment,r),s=!0)},o(r){F(n.$$.fragment,r),s=!1},d(r){r&&v(t),q(n)}}}function Ve(l){let t,n;return t=new we({props:{$$slots:{main:[Qe],left:[ze]},$$scope:{ctx:l}}}),{c(){M(t.$$.fragment)},m(e,s){O(t,e,s),n=!0},p(e,[s]){const o={};s&67110911&&(o.$$scope={dirty:s,ctx:e}),t.$set(o)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){F(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function Xe(l){let t=l.properties.way;window.open(`http://openstreetmap.org/way/${t}`,"_blank")}function Q(l,t,n){if(l=="lts")return null;if(l=="cost")return _e(0,t);if(l=="nearby_amenities")return _e(0,n)}function _e(l,t){let n=[],e=(t-l)/5;for(let s=0;s<6;s++)n.push(l+s*e);return n}function Ye(l,t,n){ke(async()=>{await Je(),await Ce()});let e,s,o="",f={type:"FeatureCollection",features:[]},r="Distance",i="cost",_=!1,a=[0,0,0,0,0],c=1,$=1,S;async function E(p){n(0,o=""),N(await S.files[0].arrayBuffer())}function N(p){try{n(3,s=new Te(new Uint8Array(p))),n(1,r="Distance");let w=s.getBounds();e.fitBounds([[w[0],w[1]],[w[2],w[3]]],{padding:20,animate:!1}),P()}catch(w){window.alert(`Problem loading network file: ${w}`)}}async function J(p){if(p!=""){let w=await fetch(`https://assets.od2net.org/pbf_clips/${p}.osm.pbf`);N(await w.arrayBuffer())}}function P(){n(4,f=JSON.parse(s.debugNetwork()));let p=0,w=[0,0,0,0,0];n(8,c=0),n(9,$=0);for(let b of f.features)n(9,$=Math.max($,b.properties.nearby_amenities)),b.properties.length&&(n(8,c=Math.max(c,b.properties.cost/b.properties.length)),p+=b.properties.length,w[b.properties.lts]+=b.properties.length);n(7,a=w.map(b=>b/p*100))}function m(p,w,b){if(p=="lts")return Se;if(p=="cost")return["case",["==",0,["get","lts"]],A.lts_not_allowed,ie(["/",["get","cost"],["get","length"]],Q(p,w,b),ee)];if(p=="nearby_amenities")return ie(["get","nearby_amenities"],Q(p,w,b),ee)}function d(p,w){let b=je(1,.5);return p=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,b]:w?b:["case",["==",0,["get","lts"]],0,b]}function j(p){s&&(s.updateCostFunction(p),P())}const L=p=>Xe(p.detail.features[0]);function R(p){e=p,n(2,e)}function G(p){V[p?"unshift":"push"](()=>{S=p,n(10,S)})}function z(p){o=p,n(0,o)}function U(){i=Fe(this),n(5,i)}function W(){_=this.checked,n(6,_)}function T(p){r=p,n(1,r)}return l.$$.update=()=>{l.$$.dirty&1&&J(o),l.$$.dirty&2&&j(r)},[o,r,e,s,f,i,_,a,c,$,S,E,m,d,L,R,G,z,U,W,T]}class xe extends me{constructor(t){super(),de(this,t,Ye,Ve,ge,{})}}new xe({target:document.getElementById("app")});
