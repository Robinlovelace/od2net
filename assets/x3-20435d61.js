import{S as ge,i as $e,s as be,ac as K,e as $,f as E,z as T,l as k,E as oe,v as y,ad as ae,g as W,n as b,W as he,L as ye,c as N,a as O,t as S,b as C,d as j,o as ve,H as Se,x as Y,y as le,h as Q,q as te,A as se,r as we,u as ke,M as Ce,_ as Fe,a1 as Le,a5 as P,ae as re,C as Me,j as ee,k as Ee,p as ie,w as Ne,af as ne,a2 as Oe,aa as je,ab as G,a4 as Be,a6 as qe,a7 as Te}from"./Legend-07540826.js";import{L as Je,C as Pe,O as Ae,_ as He,J as De,a as Ge,G as Ie}from"./OverpassSelector-c6601889.js";function fe(l,e,n){const t=l.slice();return t[2]=e[n],t}function ue(l,e,n){const t=l.slice();return t[5]=e[n],t}function pe(l){let e,n;return{c(){e=$("span"),n=W(`Â 
    `),T(e,"background",l[5]),T(e,"width","100%"),T(e,"border","1px solid black")},m(t,o){k(t,e,o),b(e,n)},p(t,o){o&1&&T(e,"background",t[5])},d(t){t&&y(e)}}}function ce(l){let e,n=l[2].toFixed(1)+"",t;return{c(){e=$("span"),t=W(n)},m(o,s){k(o,e,s),b(e,t)},p(o,s){s&2&&n!==(n=o[2].toFixed(1)+"")&&he(t,n)},d(o){o&&y(e)}}}function Re(l){let e,n,t,o=K(l[0]),s=[];for(let a=0;a<o.length;a+=1)s[a]=pe(ue(l,o,a));let u=K(l[1]),f=[];for(let a=0;a<u.length;a+=1)f[a]=ce(fe(l,u,a));return{c(){e=$("div");for(let a=0;a<s.length;a+=1)s[a].c();n=E(),t=$("div");for(let a=0;a<f.length;a+=1)f[a].c();T(e,"display","flex"),T(t,"display","flex"),T(t,"justify-content","space-between")},m(a,m){k(a,e,m);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null);k(a,n,m),k(a,t,m);for(let r=0;r<f.length;r+=1)f[r]&&f[r].m(t,null)},p(a,[m]){if(m&1){o=K(a[0]);let r;for(r=0;r<o.length;r+=1){const d=ue(a,o,r);s[r]?s[r].p(d,m):(s[r]=pe(d),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=o.length}if(m&2){u=K(a[1]);let r;for(r=0;r<u.length;r+=1){const d=fe(a,u,r);f[r]?f[r].p(d,m):(f[r]=ce(d),f[r].c(),f[r].m(t,null))}for(;r<f.length;r+=1)f[r].d(1);f.length=u.length}},i:oe,o:oe,d(a){a&&(y(e),y(n),y(t)),ae(s,a),ae(f,a)}}}function Xe(l,e,n){let{colorScale:t}=e,{limits:o}=e;return l.$$set=s=>{"colorScale"in s&&n(0,t=s.colorScale),"limits"in s&&n(1,o=s.limits)},[t,o]}class ze extends ge{constructor(e){super(),$e(this,e,Xe,Re,be,{colorScale:0,limits:1})}}function _e(l){let e,n;return{c(){e=$("p"),n=W(l[12])},m(t,o){k(t,e,o),b(e,n)},p(t,o){o&4096&&he(n,t[12])},d(t){t&&y(e)}}}function me(l){let e,n,t,o,s,u,f,a,m,r,d,v,h,B,q,F,H,A,I,D,c,g,_,L,R;const X=[Ue,We],J=[];function U(p,i){return p[5]=="lts"?0:1}d=U(l),v=J[d]=X[d](l);function x(p){l[24](p)}let Z={};return l[1]!==void 0&&(Z.cost=l[1]),c=new Ge({props:Z}),Y.push(()=>le(c,"cost",x)),{c(){e=$("hr"),n=E(),t=$("div"),o=$("label"),s=W(`Color edges by:
          `),u=$("select"),f=$("option"),f.textContent="LTS",a=$("option"),a.textContent="Edge cost (relative to length)",m=$("option"),m.textContent="Nearby amenities",r=E(),v.c(),h=E(),B=$("div"),q=$("label"),F=$("input"),H=W(`
          Show cyclists not allowed`),A=E(),I=$("hr"),D=E(),N(c.$$.fragment),f.__value="lts",ee(f,f.__value),a.__value="cost",ee(a,a.__value),m.__value="nearby_amenities",ee(m,m.__value),l[5]===void 0&&Ee(()=>l[22].call(u)),Q(F,"type","checkbox"),T(q,"color",P.lts_not_allowed)},m(p,i){k(p,e,i),k(p,n,i),k(p,t,i),b(t,o),b(o,s),b(o,u),b(u,f),b(u,a),b(u,m),ie(u,l[5],!0),k(p,r,i),J[d].m(p,i),k(p,h,i),k(p,B,i),b(B,q),b(q,F),F.checked=l[6],b(q,H),k(p,A,i),k(p,I,i),k(p,D,i),O(c,p,i),_=!0,L||(R=[te(u,"change",l[22]),te(F,"change",l[23])],L=!0)},p(p,i){i&32&&ie(u,p[5]);let w=d;d=U(p),d===w?J[d].p(p,i):(we(),C(J[w],1,1,()=>{J[w]=null}),ke(),v=J[d],v?v.p(p,i):(v=J[d]=X[d](p),v.c()),S(v,1),v.m(h.parentNode,h)),i&64&&(F.checked=p[6]);const M={};!g&&i&2&&(g=!0,M.cost=p[1],se(()=>g=!1)),c.$set(M)},i(p){_||(S(v),S(c.$$.fragment,p),_=!0)},o(p){C(v),C(c.$$.fragment,p),_=!1},d(p){p&&(y(e),y(n),y(t),y(r),y(h),y(B),y(A),y(I),y(D)),J[d].d(p),j(c,p),L=!1,Ne(R)}}}function We(l){let e,n;return e=new ze({props:{colorScale:ne,limits:V(l[5],l[9],l[10])}}),{c(){N(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,o){const s={};o&1568&&(s.limits=V(t[5],t[9],t[10])),e.$set(s)},i(t){n||(S(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Ue(l){let e,n,t,o;return e=new je({props:{rows:[[`${G.lts1}: ${l[8][1].toFixed(0)}% of roads by distance`,P.lts1],[`${G.lts2}: ${l[8][2].toFixed(0)}%`,P.lts2],[`${G.lts3}: ${l[8][3].toFixed(0)}%`,P.lts3],[`${G.lts4}: ${l[8][4].toFixed(0)}%`,P.lts4]]}}),{c(){N(e.$$.fragment),n=E(),t=$("p"),t.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,u){O(e,s,u),k(s,n,u),k(s,t,u),o=!0},p(s,u){const f={};u&256&&(f.rows=[[`${G.lts1}: ${s[8][1].toFixed(0)}% of roads by distance`,P.lts1],[`${G.lts2}: ${s[8][2].toFixed(0)}%`,P.lts2],[`${G.lts3}: ${s[8][3].toFixed(0)}%`,P.lts3],[`${G.lts4}: ${s[8][4].toFixed(0)}%`,P.lts4]]),e.$set(f)},i(s){o||(S(e.$$.fragment,s),o=!0)},o(s){C(e.$$.fragment,s),o=!1},d(s){s&&(y(n),y(t)),j(e,s)}}}function Ze(l){let e,n,t,o,s,u,f,a,m,r,d,v,h,B,q,F,H,A;n=new Se({props:{app:"costs"}});function I(_){l[19](_)}let D={};l[0]!==void 0&&(D.example=l[0]),r=new Pe({props:D}),Y.push(()=>le(r,"example",I)),h=new Ae({props:{map:l[2]}}),h.$on("gotXml",l[16]),h.$on("loading",l[20]),h.$on("error",l[21]);let c=l[12]&&_e(l),g=l[3]&&me(l);return{c(){e=$("div"),N(n.$$.fragment),t=E(),o=$("label"),s=W("Open an "),u=$("i"),u.textContent=".osm.pbf",f=W(`
      file
      `),a=$("input"),m=E(),N(r.$$.fragment),v=E(),N(h.$$.fragment),B=E(),c&&c.c(),q=E(),g&&g.c(),Q(a,"type","file"),Q(e,"slot","left")},m(_,L){k(_,e,L),O(n,e,null),b(e,t),b(e,o),b(o,s),b(o,u),b(o,f),b(o,a),l[18](a),b(e,m),O(r,e,null),b(e,v),O(h,e,null),b(e,B),c&&c.m(e,null),b(e,q),g&&g.m(e,null),F=!0,H||(A=te(a,"change",l[13]),H=!0)},p(_,L){const R={};!d&&L&1&&(d=!0,R.example=_[0],se(()=>d=!1)),r.$set(R);const X={};L&4&&(X.map=_[2]),h.$set(X),_[12]?c?c.p(_,L):(c=_e(_),c.c(),c.m(e,q)):c&&(c.d(1),c=null),_[3]?g?(g.p(_,L),L&8&&S(g,1)):(g=me(_),g.c(),S(g,1),g.m(e,null)):g&&(we(),C(g,1,1,()=>{g=null}),ke())},i(_){F||(S(n.$$.fragment,_),S(r.$$.fragment,_),S(h.$$.fragment,_),S(g),F=!0)},o(_){C(n.$$.fragment,_),C(r.$$.fragment,_),C(h.$$.fragment,_),C(g),F=!1},d(_){_&&y(e),j(n),l[18](null),j(r),j(h),c&&c.d(),g&&g.d(),H=!1,A()}}}function Ke(l){let e,n;return e=new Te({props:{properties:l[29]}}),{c(){N(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,o){const s={};o&536870912&&(s.properties=t[29]),e.$set(s)},i(t){n||(S(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Qe(l){let e,n;return e=new qe({props:{$$slots:{default:[Ke,({props:t})=>({29:t}),({props:t})=>t?536870912:0]},$$scope:{ctx:l}}}),{c(){N(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,o){const s={};o&1610612736&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(S(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Ve(l){let e,n;return e=new Be({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":l[14](l[5],l[9],l[10]),"line-opacity":l[15](l[5],l[6])},beforeId:"Road labels",$$slots:{default:[Qe]},$$scope:{ctx:l}}}),e.$on("click",tt),{c(){N(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,o){const s={};o&1632&&(s.paint={"line-width":5,"line-color":t[14](t[5],t[9],t[10]),"line-opacity":t[15](t[5],t[6])}),o&1073741824&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(S(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Ye(l){let e,n;return e=new Ie({props:{data:l[4],$$slots:{default:[Ve]},$$scope:{ctx:l}}}),{c(){N(e.$$.fragment)},m(t,o){O(e,t,o),n=!0},p(t,o){const s={};o&16&&(s.data=t[4]),o&1073743456&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(S(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function xe(l){let e,n,t,o;function s(f){l[17](f)}let u={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ye]},$$scope:{ctx:l}};return l[2]!==void 0&&(u.map=l[2]),n=new Ce({props:u}),Y.push(()=>le(n,"map",s)),{c(){e=$("div"),N(n.$$.fragment),Q(e,"slot","main"),T(e,"position","relative"),T(e,"width","100%"),T(e,"height","100vh")},m(f,a){k(f,e,a),O(n,e,null),o=!0},p(f,a){const m={};a&1073743472&&(m.$$scope={dirty:a,ctx:f}),!t&&a&4&&(t=!0,m.map=f[2],se(()=>t=!1)),n.$set(m)},i(f){o||(S(n.$$.fragment,f),o=!0)},o(f){C(n.$$.fragment,f),o=!1},d(f){f&&y(e),j(n)}}}function et(l){let e,n,t,o;return e=new ye({props:{$$slots:{main:[xe],left:[Ze]},$$scope:{ctx:l}}}),t=new Je({props:{loading:l[7]}}),{c(){N(e.$$.fragment),n=E(),N(t.$$.fragment)},m(s,u){O(e,s,u),k(s,n,u),O(t,s,u),o=!0},p(s,[u]){const f={};u&1073749887&&(f.$$scope={dirty:u,ctx:s}),e.$set(f);const a={};u&128&&(a.loading=s[7]),t.$set(a)},i(s){o||(S(e.$$.fragment,s),S(t.$$.fragment,s),o=!0)},o(s){C(e.$$.fragment,s),C(t.$$.fragment,s),o=!1},d(s){s&&y(n),j(e,s),j(t,s)}}}function tt(l){let e=l.detail.features[0].properties.way;window.open(`http://openstreetmap.org/way/${e}`,"_blank")}function V(l,e,n){if(l=="lts")return[];if(l=="cost")return de(0,e);if(l=="nearby_amenities")return de(0,n);throw new Error("unreachable")}function de(l,e){let n=[],t=(e-l)/5;for(let o=0;o<6;o++)n.push(l+o*t);return n}function nt(l,e,n){ve(async()=>{await He(),await Fe()});let t,o,s="",u={type:"FeatureCollection",features:[]},f="Distance",a="cost",m=!1,r=!1,d=[0,0,0,0,0],v=1,h=1,B;async function q(i){n(0,s=""),n(7,r=!0),F(await B.files[0].arrayBuffer())}function F(i){try{n(3,o=new De(new Uint8Array(i))),n(1,f="Distance");let w=o.getBounds();t.fitBounds([[w[0],w[1]],[w[2],w[3]]],{padding:20,animate:!1}),A()}catch(w){window.alert(`Problem importing osm.pbf file: ${w}`)}n(7,r=!1)}async function H(i){if(i!=""){n(7,r=!0);let w=await fetch(`https://assets.od2net.org/pbf_clips/${i}.osm.pbf`);F(await w.arrayBuffer())}}function A(){n(4,u=JSON.parse(o.debugNetwork()));let i=0,w=[0,0,0,0,0];n(9,v=0),n(10,h=0);for(let M of u.features){let z=M.properties;n(10,h=Math.max(h,z.nearby_amenities)),z.length&&(n(9,v=Math.max(v,z.forward_cost/z.length)),i+=z.length,w[z.lts]+=z.length)}n(8,d=w.map(M=>M/i*100))}function I(i,w,M){if(i=="lts")return Le;if(i=="cost")return["case",["==",0,["get","lts"]],P.lts_not_allowed,re(["/",["get","forward_cost"],["get","length"]],V(i,w,M),ne)];if(i=="nearby_amenities")return re(["get","nearby_amenities"],V(i,w,M),ne);throw new Error("unreachable")}function D(i,w){let M=Oe(1,.5);return i=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,M]:w?M:["case",["==",0,["get","lts"]],0,M]}let c="";function g(i){n(12,c="Parsing XML"),F(new TextEncoder().encode(i.detail)),n(12,c="")}function _(i){o&&(o.updateCostFunction(i),A())}function L(i){t=i,n(2,t)}function R(i){Y[i?"unshift":"push"](()=>{B=i,n(11,B)})}function X(i){s=i,n(0,s)}const J=i=>n(12,c=i.detail),U=i=>n(12,c=i.detail);function x(){a=Me(this),n(5,a)}function Z(){m=this.checked,n(6,m)}function p(i){f=i,n(1,f)}return l.$$.update=()=>{l.$$.dirty&1&&H(s),l.$$.dirty&2&&_(f)},[s,f,t,o,u,a,m,r,d,v,h,B,c,q,I,D,g,L,R,X,J,U,x,Z,p]}class lt extends ge{constructor(e){super(),$e(this,e,nt,et,be,{})}}new lt({target:document.getElementById("app")});
