import{S as ie,i as ae,s as re,ab as G,e as $,f as M,z as L,l as h,E as V,v as w,ac as X,g as A,n as b,a6 as de,L as $e,c as j,a as N,t as v,b as C,d as q,o as ge,H as be,h as D,q as fe,r as ue,u as ce,M as he,x as W,y as pe,A as _e,_ as we,$ as ke,ad as Y,C as ve,j as z,k as ye,p as x,ae as U,a9 as Ce,aa as J,a3 as T,a2 as Se,a0 as I,a4 as Fe,a5 as Le}from"./Legend-b21e3702.js";import{_ as je,J as Ne,C as qe,G as Oe}from"./CostFunction-b0dd55a1.js";function ee(o,t,l){const e=o.slice();return e[2]=t[l],e}function te(o,t,l){const e=o.slice();return e[5]=t[l],e}function ne(o){let t,l;return{c(){t=$("span"),l=A(`Â 
    `),L(t,"background",o[5]),L(t,"width","100%"),L(t,"border","1px solid black")},m(e,n){h(e,t,n),b(t,l)},p(e,n){n&1&&L(t,"background",e[5])},d(e){e&&w(t)}}}function le(o){let t,l=o[2]+"",e;return{c(){t=$("span"),e=A(l)},m(n,s){h(n,t,s),b(t,e)},p(n,s){s&2&&l!==(l=n[2]+"")&&de(e,l)},d(n){n&&w(t)}}}function Me(o){let t,l,e,n=G(o[0]),s=[];for(let i=0;i<n.length;i+=1)s[i]=ne(te(o,n,i));let f=G(o[1]),r=[];for(let i=0;i<f.length;i+=1)r[i]=le(ee(o,f,i));return{c(){t=$("div");for(let i=0;i<s.length;i+=1)s[i].c();l=M(),e=$("div");for(let i=0;i<r.length;i+=1)r[i].c();L(t,"display","flex"),L(e,"display","flex"),L(e,"justify-content","space-between")},m(i,c){h(i,t,c);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(t,null);h(i,l,c),h(i,e,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(i,[c]){if(c&1){n=G(i[0]);let a;for(a=0;a<n.length;a+=1){const p=te(i,n,a);s[a]?s[a].p(p,c):(s[a]=ne(p),s[a].c(),s[a].m(t,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=n.length}if(c&2){f=G(i[1]);let a;for(a=0;a<f.length;a+=1){const p=ee(i,f,a);r[a]?r[a].p(p,c):(r[a]=le(p),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=f.length}},i:V,o:V,d(i){i&&(w(t),w(l),w(e)),X(s,i),X(r,i)}}}function Be(o,t,l){let{colorScale:e}=t,{limits:n}=t;return o.$$set=s=>{"colorScale"in s&&l(0,e=s.colorScale),"limits"in s&&l(1,n=s.limits)},[e,n]}class Ee extends ie{constructor(t){super(),ae(this,t,Be,Me,re,{colorScale:0,limits:1})}}function se(o){let t,l,e,n,s,f,r,i,c,a,p,g,S,B,_,d,F,H,m,O;const y=[Te,Je],E=[];function Z(u,k){return u[4]=="lts"?0:1}p=Z(o),g=E[p]=y[p](o);function me(u){o[13](u)}let K={};return o[0]!==void 0&&(K.cost=o[0]),d=new qe({props:K}),W.push(()=>pe(d,"cost",me)),{c(){t=$("hr"),l=M(),e=$("div"),n=$("label"),s=A(`Color edges by:
          `),f=$("select"),r=$("option"),r.textContent="LTS",i=$("option"),i.textContent="Edge cost (relative to length)",c=$("option"),c.textContent="Nearby amenities",a=M(),g.c(),S=M(),B=$("hr"),_=M(),j(d.$$.fragment),r.__value="lts",z(r,r.__value),i.__value="cost",z(i,i.__value),c.__value="nearby_amenities",z(c,c.__value),o[4]===void 0&&ye(()=>o[12].call(f))},m(u,k){h(u,t,k),h(u,l,k),h(u,e,k),b(e,n),b(n,s),b(n,f),b(f,r),b(f,i),b(f,c),x(f,o[4],!0),h(u,a,k),E[p].m(u,k),h(u,S,k),h(u,B,k),h(u,_,k),N(d,u,k),H=!0,m||(O=fe(f,"change",o[12]),m=!0)},p(u,k){k&16&&x(f,u[4]);let R=p;p=Z(u),p===R?E[p].p(u,k):(ue(),C(E[R],1,1,()=>{E[R]=null}),ce(),g=E[p],g?g.p(u,k):(g=E[p]=y[p](u),g.c()),v(g,1),g.m(S.parentNode,S));const Q={};!F&&k&1&&(F=!0,Q.cost=u[0],_e(()=>F=!1)),d.$set(Q)},i(u){H||(v(g),v(d.$$.fragment,u),H=!0)},o(u){C(g),C(d.$$.fragment,u),H=!1},d(u){u&&(w(t),w(l),w(e),w(a),w(S),w(B),w(_)),E[p].d(u),q(d,u),m=!1,O()}}}function Je(o){let t,l;return t=new Ee({props:{colorScale:U,limits:P(o[4])}}),{c(){j(t.$$.fragment)},m(e,n){N(t,e,n),l=!0},p(e,n){const s={};n&16&&(s.limits=P(e[4])),t.$set(s)},i(e){l||(v(t.$$.fragment,e),l=!0)},o(e){C(t.$$.fragment,e),l=!1},d(e){q(t,e)}}}function Te(o){let t,l,e,n;return t=new Ce({props:{rows:[[`${J.lts1}: ${o[5][1].toFixed(0)}%`,T.lts1],[`${J.lts2}: ${o[5][2].toFixed(0)}%`,T.lts2],[`${J.lts3}: ${o[5][3].toFixed(0)}%`,T.lts3],[`${J.lts4}: ${o[5][4].toFixed(0)}%`,T.lts4]]}}),{c(){j(t.$$.fragment),l=M(),e=$("p"),e.innerHTML='Note: LTS model from <a href="https://github.com/BikeOttawa/stressmodel/blob/master/stressmodel.js" target="_blank">BikeOttawa</a>'},m(s,f){N(t,s,f),h(s,l,f),h(s,e,f),n=!0},p(s,f){const r={};f&32&&(r.rows=[[`${J.lts1}: ${s[5][1].toFixed(0)}%`,T.lts1],[`${J.lts2}: ${s[5][2].toFixed(0)}%`,T.lts2],[`${J.lts3}: ${s[5][3].toFixed(0)}%`,T.lts3],[`${J.lts4}: ${s[5][4].toFixed(0)}%`,T.lts4]]),t.$set(r)},i(s){n||(v(t.$$.fragment,s),n=!0)},o(s){C(t.$$.fragment,s),n=!1},d(s){s&&(w(l),w(e)),q(t,s)}}}function He(o){let t,l,e,n,s,f,r,i,c,a,p,g,S,B;l=new be({props:{app:"costs"}});let _=o[2]&&se(o);return{c(){t=$("div"),j(l.$$.fragment),e=M(),n=$("label"),s=A("Open a "),f=$("i"),f.textContent=".bin",r=A(" network file or an "),i=$("i"),i.textContent=".osm.pbf",c=M(),a=$("input"),p=M(),_&&_.c(),D(a,"type","file"),D(t,"slot","left")},m(d,F){h(d,t,F),N(l,t,null),b(t,e),b(t,n),b(n,s),b(n,f),b(n,r),b(n,i),b(n,c),b(n,a),o[11](a),b(t,p),_&&_.m(t,null),g=!0,S||(B=fe(a,"change",o[7]),S=!0)},p(d,F){d[2]?_?(_.p(d,F),F&4&&v(_,1)):(_=se(d),_.c(),v(_,1),_.m(t,null)):_&&(ue(),C(_,1,1,()=>{_=null}),ce())},i(d){g||(v(l.$$.fragment,d),v(_),g=!0)},o(d){C(l.$$.fragment,d),C(_),g=!1},d(d){d&&w(t),q(l),o[11](null),_&&_.d(),S=!1,B()}}}function Ae(o){let t,l;return t=new Le({props:{properties:o[16][0].properties}}),{c(){j(t.$$.fragment)},m(e,n){N(t,e,n),l=!0},p(e,n){const s={};n&65536&&(s.properties=e[16][0].properties),t.$set(s)},i(e){l||(v(t.$$.fragment,e),l=!0)},o(e){C(t.$$.fragment,e),l=!1},d(e){q(t,e)}}}function Ge(o){let t,l;return t=new Fe({props:{openOn:"hover",$$slots:{default:[Ae,({features:e})=>({16:e}),({features:e})=>e?65536:0]},$$scope:{ctx:o}}}),{c(){j(t.$$.fragment)},m(e,n){N(t,e,n),l=!0},p(e,n){const s={};n&196608&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){l||(v(t.$$.fragment,e),l=!0)},o(e){C(t.$$.fragment,e),l=!1},d(e){q(t,e)}}}function Ie(o){let t,l;return t=new Se({props:{manageHoverState:!0,hoverCursor:"pointer",paint:{"line-width":5,"line-color":o[8](o[4]),"line-opacity":o[4]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,I(1,.5)]:I(1,.5)},beforeId:"Road labels",$$slots:{default:[Ge]},$$scope:{ctx:o}}}),t.$on("click",o[9]),{c(){j(t.$$.fragment)},m(e,n){N(t,e,n),l=!0},p(e,n){const s={};n&16&&(s.paint={"line-width":5,"line-color":e[8](e[4]),"line-opacity":e[4]=="nearby_amenities"?["case",["==",0,["get","nearby_amenities"]],0,I(1,.5)]:I(1,.5)}),n&131072&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){l||(v(t.$$.fragment,e),l=!0)},o(e){C(t.$$.fragment,e),l=!1},d(e){q(t,e)}}}function Pe(o){let t,l;return t=new Oe({props:{data:o[3],$$slots:{default:[Ie]},$$scope:{ctx:o}}}),{c(){j(t.$$.fragment)},m(e,n){N(t,e,n),l=!0},p(e,n){const s={};n&8&&(s.data=e[3]),n&131088&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){l||(v(t.$$.fragment,e),l=!0)},o(e){C(t.$$.fragment,e),l=!1},d(e){q(t,e)}}}function Re(o){let t,l,e,n;function s(r){o[10](r)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Pe]},$$scope:{ctx:o}};return o[1]!==void 0&&(f.map=o[1]),l=new he({props:f}),W.push(()=>pe(l,"map",s)),{c(){t=$("div"),j(l.$$.fragment),D(t,"slot","main"),L(t,"position","relative"),L(t,"width","100%"),L(t,"height","100vh")},m(r,i){h(r,t,i),N(l,t,null),n=!0},p(r,i){const c={};i&131096&&(c.$$scope={dirty:i,ctx:r}),!e&&i&2&&(e=!0,c.map=r[1],_e(()=>e=!1)),l.$set(c)},i(r){n||(v(l.$$.fragment,r),n=!0)},o(r){C(l.$$.fragment,r),n=!1},d(r){r&&w(t),q(l)}}}function ze(o){let t,l;return t=new $e({props:{$$slots:{main:[Re],left:[He]},$$scope:{ctx:o}}}),{c(){j(t.$$.fragment)},m(e,n){N(t,e,n),l=!0},p(e,[n]){const s={};n&131199&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){l||(v(t.$$.fragment,e),l=!0)},o(e){C(t.$$.fragment,e),l=!1},d(e){q(t,e)}}}function De(o){let t=o.properties.way;window.open(`http://openstreetmap.org/way/${t}`,"_blank")}function P(o){if(o=="lts")return null;if(o=="cost")return oe(1,30);if(o=="nearby_amenities")return oe(0,20)}function oe(o,t){let l=[],e=(t-o)/5;for(let n=0;n<6;n++)l.push(o+n*e);return l}function Ue(o,t,l){ge(async()=>{await je(),await we()});let e,n,s={type:"FeatureCollection",features:[]},f="Distance",r="cost",i=[0,0,0,0,0],c;async function a(m){try{let O=await c.files[0].arrayBuffer();l(2,n=new Ne(new Uint8Array(O)));let y=n.getBounds();e.fitBounds([[y[0],y[1]],[y[2],y[3]]],{padding:20,animate:!1}),p()}catch(O){window.alert(`Problem loading network file: ${O}`)}}function p(){l(3,s=JSON.parse(n.debugNetwork()));let m=0,O=[0,0,0,0,0];for(let y of s.features)y.properties.length&&(m+=y.properties.length,O[y.properties.lts]+=y.properties.length);l(5,i=O.map(y=>y/m*100))}function g(m){if(m=="lts")return ke;if(m=="cost")return Y(["/",["get","cost"],["get","length"]],P(m),U);if(m=="nearby_amenities")return Y(["get","nearby_amenities"],P(m),U)}function S(m){n&&(n.updateCostFunction(m),p())}const B=m=>De(m.detail.features[0]);function _(m){e=m,l(1,e)}function d(m){W[m?"unshift":"push"](()=>{c=m,l(6,c)})}function F(){r=ve(this),l(4,r)}function H(m){f=m,l(0,f)}return o.$$.update=()=>{o.$$.dirty&1&&S(f)},[f,e,n,s,r,i,c,a,g,B,_,d,F,H]}class We extends ie{constructor(t){super(),ae(this,t,Ue,ze,re,{})}}new We({target:document.getElementById("app")});
